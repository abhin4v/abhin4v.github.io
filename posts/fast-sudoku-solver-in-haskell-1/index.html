<!doctype html>
<html lang="en" class="no-js" prefix="og: http://ogp.me/ns#">
    <head>
        <meta charset="utf-8">
        <meta name="copyright" content="Abhinav Sarkar">
        <meta name="robots" content="index,follow">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="google-site-verification" content="jqi6GjA_kvmDkzCQwNJIPilm810Wwt6P0wsDmiSKmqk">
        
        <meta name="twitter:card" content="summary">
        
        <meta name="twitter:creator" content="@abhin4v">
        <meta name="twitter:title" content="Fast Sudoku Solver in Haskell #1: A Simple Solution">

        <meta property="og:url" content="https://abhinavsarkar.net/posts/fast-sudoku-solver-in-haskell-1/">
        <meta property="og:type" content="article">
        <meta property="og:title" content="Fast Sudoku Solver in Haskell #1: A Simple Solution">
        <meta property="og:locale" content="en_US">
        <meta property="og:site_name" content="abhinavsarkar.net">
        
        <meta name="keywords" content="haskell, sudoku, programming, puzzle, nilenso">
        
        
        <meta name="description" content="We write a Sudoku Solver in Haskell and optimize it to be fast">
        <meta property="og:description" content="We write a Sudoku Solver in Haskell and optimize it to be fast">
        <meta name="twitter:description" content="We write a Sudoku Solver in Haskell and optimize it to be fast">
        
        

        <meta name="language" content="EN">
        <meta name="author" content="Abhinav Sarkar, abhinav@abhinavsarkar.net">
        <meta name="HandheldFriendly" content="True">

        <title>Fast Sudoku Solver in Haskell #1: A Simple Solution | abhinavsarkar.net</title>

        <link rel="shortcut icon" type="image/x-icon" href="//abhinavsarkar.net/images/favicon.ico">
        <link rel="archives" title="Archive" href="https://abhinavsarkar.net/archive/">
        <link rel="canonical" href="https://abhinavsarkar.net/posts/fast-sudoku-solver-in-haskell-1/">
        
        <link rel="next" href="//abhinavsarkar.net/posts/fast-sudoku-solver-in-haskell-2/">
        <link rel="me" href="https://abhinavsarkar.net/about/" type="text/html">
        <link rel="me" href="https://twitter.com/abhin4v">
        <link rel="me" href="https://github.com/abhin4v">
        <link rel="pingback" href="https://webmention.io/abhinavsarkar.net/xmlrpc" />
        <link rel="webmention" href="https://webmention.io/abhinavsarkar.net/webmention" />
        <link rel="alternate" type="application/atom+xml" title="abhinavsarkar.net" href="https://abhinavsarkar.net/feed.atom">
        <link rel="alternate" type="application/atom+xml" title="notes.abhinavsarkar.net" href="https://notes.abhinavsarkar.net/feed.atom">

        <script>
        (function() {
          var allowedDomains = ["localhost", "127.0.0.1", "abhinavsarkar.net", "web.archive.org"];
          if (allowedDomains.indexOf(window.location.hostname) == -1) {
            if (window.location.protocol == "http:") {
              location.host = "abhinavsarkar.net:80";
            } else {
              location.host = "abhinavsarkar.net:443";
            }
          }
        })();
        </script>

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css" media="preload" onload="if (media != 'all') media = 'all';">
        <link rel="stylesheet" href="//abhinavsarkar.net/css/article.css" media="preload" onload="if (media != 'all') media = 'all';">
        <noscript>
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css">
          <link rel="stylesheet" href="//abhinavsarkar.net/css/article.css">
        </noscript>

        <!-- Matomo -->
        <script type="text/javascript">
          var _paq = _paq || [];
          _paq.push(['trackPageView']);
          _paq.push(['enableLinkTracking']);
          _paq.push(['trackVisibleContentImpressions']);
          (function() {
            var u="//anna.abhinavsarkar.net/";
            _paq.push(['setTrackerUrl', u+'piwik.php']);
            _paq.push(['setSiteId', '1']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
          })();
        </script>
        <!-- End Matomo Code -->
    </head>
    <body class="article-page ">
        <noscript>
          <img src="https://anna.abhinavsarkar.net/piwik.php?idsite=1&amp;rec=1" style="border:0; display: none;" alt />
        </noscript>
        <header>
            <nav id="topnav">
                <span class="logo">
                  <a href="//abhinavsarkar.net/">abhinavsarkar.net</a>
                  <label for="menu-toggle" class="label-toggle">
                    <svg height="1em" version="1.1" viewBox="0 0 25 25" width="1em" xmlns="http://www.w3.org/2000/svg" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns" xmlns:xlink="http://www.w3.org/1999/xlink">
                      <g id="hamburger-round">
                        <path d="M0,4 C0,2.8954305 0.889763236,2 2.00359486,2 L22.9964051,2 C24.10296,2 25,2.88772964 25,4 C25,5.1045695 24.1102368,6 22.9964051,6 L2.00359486,6 C0.897039974,6 0,5.11227036 0,4 L0,4 Z M0,12 C0,10.8954305 0.889763236,10 2.00359486,10 L22.9964051,10 C24.10296,10 25,10.8877296 25,12 C25,13.1045695 24.1102368,14 22.9964051,14 L2.00359486,14 C0.897039974,14 0,13.1122704 0,12 L0,12 Z M0,20 C0,18.8954305 0.889763236,18 2.00359486,18 L22.9964051,18 C24.10296,18 25,18.8877296 25,20 C25,21.1045695 24.1102368,22 22.9964051,22 L2.00359486,22 C0.897039974,22 0,21.1122704 0,20 L0,20 Z" id="hamburger"></path>
                      </g>
                    </svg>
                  </label>
                </span>
                <span class="links">
                  <input type="checkbox" id="menu-toggle">
                  <a href="//abhinavsarkar.net/about/">About</a>
<a href="//abhinavsarkar.net/archive/">Posts</a>
<a href="//abhinavsarkar.net/notes/">Notes</a>
<a href="//abhinavsarkar.net/photos/">Photos</a>
<a href="//abhinavsarkar.net/readings/">Readings</a>
<a href="//abhinavsarkar.net/now/">Now</a>
                </span>
            </nav>
        </header>

        <main role="main">
            <article itemscope itemtype="http://schema.org/Article" class="post h-entry">
    <header>
        <h1 itemprop="name" id="#top" class="p-name">Fast Sudoku Solver in Haskell #1: A Simple Solution</h1>
    </header>

    <ul class="headers">
      <li class="header post-publish-date">
        <svg class="assist-icon" xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8">
          <path d="M6 0l-1 1 2 2 1-1-2-2zm-2 2l-4 4v2h2l4-4-2-2z"></path>
        </svg>
        <span itemprop="datePublished" content="2018-06-28"><time class="dt-published" datetime="2018-06-28">June 28, 2018</time></span>
      </li>
      <li class="header post-ert">
        <svg class="assist-icon" xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8">
          <path d="M4 0c-2.2 0-4 1.8-4 4s1.8 4 4 4 4-1.8 4-4-1.8-4-4-4zm0 1c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm-.5 1v2.22l.16.13.5.5.34.38.72-.72-.38-.34-.34-.34v-1.81h-1z"></path>
        </svg>
        A thirty-one minute read
      </li>
      
      <li class="header post-comments">
        <svg class="assist-icon" xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8">
          <path d="M.09 0c-.06 0-.09.04-.09.09v5.81c0 .05.04.09.09.09h5.91l2 2v-7.91c0-.06-.04-.09-.09-.09h-7.81z"></path>
        </svg>
        <a href="#comment-container">2 comments</a>
      </li>
      
      <li class="header post-download">
        <svg class="assist-icon" xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8">
          <path d="M3 0v3h-2l3 3 3-3h-2v-3h-2zm-3 7v1h8v-1h-8z"></path>
        </svg>
        <a href="//abhinavsarkar.net/pdfs/posts/fast-sudoku-solver-in-haskell-1.pdf" download rel="nofollow">Download</a>
      </li>
      <li class="header post-tags">
        
        <svg class="assist-icon tags" xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8">
          <path d="M0 0v2l3 3 1.5-1.5.5-.5-2-2-1-1h-2zm3.41 0l3 3-1.19 1.22.78.78 2-2-3-3h-1.59zm-1.91 1c.28 0 .5.22.5.5s-.22.5-.5.5-.5-.22-.5-.5.22-.5.5-.5z" transform="translate(0 1)"></path>
        </svg> Tags: <span class="p-category"><a href="//abhinavsarkar.net/tags/haskell/">haskell</a>, <a href="//abhinavsarkar.net/tags/sudoku/">sudoku</a>, <a href="//abhinavsarkar.net/tags/programming/">programming</a>, <a href="//abhinavsarkar.net/tags/puzzle/">puzzle</a>, <a href="//abhinavsarkar.net/tags/nilenso/">nilenso</a></span>
        
      </li>
      <li class="header twitter-button">
        <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-size="large" data-via="abhin4v" data-dnt="true" data-show-count="false">Tweet</a>
      </li>
    </ul>

    <section itemprop="articleBody" class="body e-content">
        <p><a href="https://en.wikipedia.org/wiki/Sudoku" target="_blank" rel="noopener">Sudoku</a> is a number placement puzzle. It consists of a 9x9 grid which is to be filled with digits from 1 to 9. Some of the cells of the grid come pre-filled and the player has to fill the rest.</p>
<p><a href="https://www.haskell.org/" target="_blank" rel="noopener">Haskell</a> is a purely functional programming language. It is a good choice to solve Sudoku given the problem’s <a href="https://en.wikipedia.org/wiki/Combinatorics" target="_blank" rel="noopener">combinatorial</a> nature. The aim of this series of posts is to write a <strong>fast</strong> Sudoku solver in Haskell. We’ll focus on both implementing the solution and making it efficient, step-by-step, starting with a slow but simple solution in this post<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<!--more-->
<p>This is the first post in a series of posts:</p>
<ol type="1">
<li><a href="//abhinavsarkar.net/posts/fast-sudoku-solver-in-haskell-1/">Fast Sudoku Solver in Haskell #1: A Simple Solution</a></li>
<li><a href="//abhinavsarkar.net/posts/fast-sudoku-solver-in-haskell-2/">Fast Sudoku Solver in Haskell #2: A 200x Faster Solution</a></li>
<li><a href="//abhinavsarkar.net/posts/fast-sudoku-solver-in-haskell-3/">Fast Sudoku Solver in Haskell #3: Picking the Right Data Structures</a></li>
</ol>
<p>Discuss this post on <a href="https://www.reddit.com/r/haskell/comments/8uapij/fast_sudoku_solver_in_haskell/" target="_blank" rel="noopener">r/haskell</a>.</p>
<nav id="toc" class="right-toc"><h3>Contents</h3><ol><li><a href="#constraint-satisfaction-problem">Constraint Satisfaction Problem</a></li><li><a href="#setting-up">Setting up</a></li><li><a href="#pruning-the-cells">Pruning the Cells</a></li><li><a href="#pruning-the-grid">Pruning the Grid</a></li><li><a href="#making-the-choice">Making the Choice</a></li><li><a href="#solving-the-puzzle">Solving the Puzzle</a></li><li><a href="#conclusion">Conclusion</a></li></ol></nav>
<h2 id="constraint-satisfaction-problem" data-track-content data-content-name="constraint-satisfaction-problem" data-content-piece="fast-sudoku-solver-in-haskell-1">Constraint Satisfaction Problem<a href="#constraint-satisfaction-problem" class="ref-link"></a><a href="#top" class="top-link" title="Back to top"></a></h2>
<p>Solving Sudoku is a <a href="https://en.wikipedia.org/wiki/Constraint_satisfaction_problem" target="_blank" rel="noopener">constraint satisfaction problem</a>. We are given a partially filled grid which we have to fill completely such that each of the following constraints are satisfied:</p>
<ol type="1">
<li>Each of the nine rows must have all the digits, from 1 to 9.</li>
<li>Each of the nine columns must have all the digits, from 1 to 9.</li>
<li>Each of the nine 3x3 sub-grids must have all the digits, from 1 to 9.</li>
</ol>
<pre class="plain low-line-height"><code>+-------+-------+-------+
| . . . | . . . | . 1 . |
| 4 . . | . . . | . . . |
| . 2 . | . . . | . . . |
+-------+-------+-------+
| . . . | . 5 . | 4 . 7 |
| . . 8 | . . . | 3 . . |
| . . 1 | . 9 . | . . . |
+-------+-------+-------+
| 3 . . | 4 . . | 2 . . |
| . 5 . | 1 . . | . . . |
| . . . | 8 . 6 | . . . |
+-------+-------+-------+
    A sample puzzle

+-------+-------+-------+
| 6 9 3 | 7 8 4 | 5 1 2 |
| 4 8 7 | 5 1 2 | 9 3 6 |
| 1 2 5 | 9 6 3 | 8 7 4 |
+-------+-------+-------+
| 9 3 2 | 6 5 1 | 4 8 7 |
| 5 6 8 | 2 4 7 | 3 9 1 |
| 7 4 1 | 3 9 8 | 6 2 5 |
+-------+-------+-------+
| 3 1 9 | 4 7 5 | 2 6 8 |
| 8 5 6 | 1 2 9 | 7 4 3 |
| 2 7 4 | 8 3 6 | 1 5 9 |
+-------+-------+-------+
    and its solution</code></pre>
<p>Each cell in the grid is member of one row, one column and one sub-grid (called <em>block</em> in general). Digits in the pre-filled cells impose constraints on the rows, columns, and sub-grids they are part of. For example, if a cell contains <code>1</code> then no other cell in that cell’s row, column or sub-grid can contain <code>1</code>. Given these constraints, we can devise a simple algorithm to solve Sudoku:</p>
<ol type="1">
<li>Each cell contains either a single digit or has a set of possible digits. For example, a grid showing the possibilities of all non-filled cells for the sample puzzle above:</li>
</ol>
<pre class="small plain low-line-height overflow"><code>+-------------------------------------+-------------------------------------+-------------------------------------+
| [123456789] [123456789] [123456789] | [123456789] [123456789] [123456789] | [123456789] 1           [123456789] |
| 4           [123456789] [123456789] | [123456789] [123456789] [123456789] | [123456789] [123456789] [123456789] |
| [123456789] 2           [123456789] | [123456789] [123456789] [123456789] | [123456789] [123456789] [123456789] |
+-------------------------------------+-------------------------------------+-------------------------------------+
| [123456789] [123456789] [123456789] | [123456789] 5           [123456789] | 4           [123456789] 7           |
| [123456789] [123456789] 8           | [123456789] [123456789] [123456789] | 3           [123456789] [123456789] |
| [123456789] [123456789] 1           | [123456789] 9           [123456789] | [123456789] [123456789] [123456789] |
+-------------------------------------+-------------------------------------+-------------------------------------+
| 3           [123456789] [123456789] | 4           [123456789] [123456789] | 2           [123456789] [123456789] |
| [123456789] 5           [123456789] | 1           [123456789] [123456789] | [123456789] [123456789] [123456789] |
| [123456789] [123456789] [123456789] | 8           [123456789] 6           | [123456789] [123456789] [123456789] |
+-------------------------------------+-------------------------------------+-------------------------------------+</code></pre>
<ol start="2" type="1">
<li>If a cell contains a digit, remove that digit from the list of the possible digits from all its neighboring cells. Neighboring cells are the other cells in the given cell’s row, column and sub-grid. For example, the grid after removing the fixed value <code>4</code> of the row-2-column-1 cell from its neighboring cells:</li>
</ol>
<pre class="small plain low-line-height overflow"><code>+-------------------------------------+-------------------------------------+-------------------------------------+
| [123 56789] [123 56789] [123 56789] | [123456789] [123456789] [123456789] | [123456789] 1           [123456789] |
| 4           [123 56789] [123 56789] | [123 56789] [123 56789] [123 56789] | [123 56789] [123 56789] [123 56789] |
| [123 56789] 2           [123 56789] | [123456789] [123456789] [123456789] | [123456789] [123456789] [123456789] |
+-------------------------------------+-------------------------------------+-------------------------------------+
| [123 56789] [123456789] [123456789] | [123456789] 5           [123456789] | 4           [123456789] 7           |
| [123 56789] [123456789] 8           | [123456789] [123456789] [123456789] | 3           [123456789] [123456789] |
| [123 56789] [123456789] 1           | [123456789] 9           [123456789] | [123456789] [123456789] [123456789] |
+-------------------------------------+-------------------------------------+-------------------------------------+
| 3           [123456789] [123456789] | 4           [123456789] [123456789] | 2           [123456789] [123456789] |
| [123 56789] 5           [123456789] | 1           [123456789] [123456789] | [123456789] [123456789] [123456789] |
| [123 56789] [123456789] [123456789] | 8           [123456789] 6           | [123456789] [123456789] [123456789] |
+-------------------------------------+-------------------------------------+-------------------------------------+</code></pre>
<ol start="3" type="1">
<li>Repeat the previous step for all the cells that are have been solved (or <em>fixed</em>), either pre-filled or filled in the previous iteration of the solution. For example, the grid after removing all fixed values from all non-fixed cells:</li>
</ol>
<pre class="small plain low-line-height overflow"><code>+-------------------------------------+-------------------------------------+-------------------------------------+
| [    56789] [  3  6789] [  3 567 9] | [ 23 567 9] [ 234 678 ] [ 2345 789] | [    56789] 1           [ 23456 89] |
| 4           [1 3  6789] [  3 567 9] | [ 23 567 9] [123  678 ] [123 5 789] | [    56789] [ 23 56789] [ 23 56 89] |
| [1   56789] 2           [  3 567 9] | [  3 567 9] [1 34 678 ] [1 345 789] | [    56789] [  3456789] [  3456 89] |
+-------------------------------------+-------------------------------------+-------------------------------------+
| [ 2   6  9] [  3  6  9] [ 23  6  9] | [ 23  6   ] 5           [123    8 ] | 4           [ 2   6 89] 7           |
| [ 2  567 9] [   4 67 9] 8           | [ 2   67  ] [12 4 67  ] [12 4  7  ] | 3           [ 2  56  9] [12  56  9] |
| [ 2  567  ] [  34 67  ] 1           | [ 23  67  ] 9           [ 234  78 ] | [    56 8 ] [ 2  56 8 ] [ 2  56 8 ] |
+-------------------------------------+-------------------------------------+-------------------------------------+
| 3           [1    6789] [     67 9] | 4           7           [    5 7 9] | 2           [    56789] [1   56 89] |
| [ 2   6789] 5           [ 2 4 67 9] | 1           [ 23   7  ] [ 23   7 9] | [     6789] [  34 6789] [  34 6 89] |
| [12    7 9] [1  4  7 9] [ 2 4  7 9] | 8           [ 23   7  ] 6           | [1   5 7 9] [  345 7 9] [1 345   9] |
+-------------------------------------+-------------------------------------+-------------------------------------+</code></pre>
<ol start="4" type="1">
<li>Continue till the grid <em>settles</em>, that is, there are no more changes in the possibilities of any cells. For example, the settled grid for the current iteration:</li>
</ol>
<pre class="small plain low-line-height overflow"><code>+-------------------------------------+-------------------------------------+-------------------------------------+
| [    56789] [  3  6789] [  3 567 9] | [ 23 567 9] [ 234 6 8 ] [ 2345 789] | [    56789] 1           [ 23456 89] |
| 4           [1 3  6789] [  3 567 9] | [ 23 567 9] [123  6 8 ] [123 5 789] | [    56789] [ 23 56789] [ 23 56 89] |
| [1   56789] 2           [  3 567 9] | [  3 567 9] [1 34 6 8 ] [1 345 789] | [    56789] [  3456789] [  3456 89] |
+-------------------------------------+-------------------------------------+-------------------------------------+
| [ 2   6  9] [  3  6  9] [ 23  6  9] | [ 23  6   ] 5           [123    8 ] | 4           [ 2   6 89] 7           |
| [ 2  567 9] [   4 67 9] 8           | [ 2   67  ] [12 4 6   ] [12 4  7  ] | 3           [ 2  56  9] [12  56  9] |
| [ 2  567  ] [  34 67  ] 1           | [ 23  67  ] 9           [ 234  78 ] | [    56 8 ] [ 2  56 8 ] [ 2  56 8 ] |
+-------------------------------------+-------------------------------------+-------------------------------------+
| 3           [1    6 89] [     6  9] | 4           7           [    5   9] | 2           [    56 89] [1   56 89] |
| [ 2   6789] 5           [ 2 4 67 9] | 1           [ 23      ] [ 23     9] | [     6789] [  34 6789] [  34 6 89] |
| [12    7 9] [1  4  7 9] [ 2 4  7 9] | 8           [ 23      ] 6           | [1   5 7 9] [  345 7 9] [1 345   9] |
+-------------------------------------+-------------------------------------+-------------------------------------+</code></pre>
<ol start="5" type="1">
<li>Once the grid settles, choose one of the non-fixed cells following some strategy. Select one of the digits from all the possibilities of the cell, and fix (assume) the cell to have that digit. Go back to step 1 and repeat.</li>
<li>The elimination of possibilities may result in inconsistencies. For example, you may end up with a cell with no possibilities. In such a case, discard that branch of solution, and backtrack to last point where you fixed a cell. Choose a different possibility to fix and repeat.</li>
<li>If at any point the grid is completely filled, you’ve found the solution!</li>
<li>If you exhaust all branches of the solution then the puzzle is unsolvable. This can happen if it starts with cells pre-filled wrongly.</li>
</ol>
<p>This algorithm is actually a <a href="https://en.wikipedia.org/wiki/Depth-first_search" target="_blank" rel="noopener">Depth-First Search</a> on the <a href="https://en.wikipedia.org/wiki/State_space_search" target="_blank" rel="noopener">state space</a> of the grid configurations. It guarantees to either find a solution or prove a puzzle to be unsolvable.</p>
<h2 id="setting-up" data-track-content data-content-name="setting-up" data-content-piece="fast-sudoku-solver-in-haskell-1">Setting up<a href="#setting-up" class="ref-link"></a><a href="#top" class="top-link" title="Back to top"></a></h2>
<p>We start with writing types to represent the cells and the grid:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">data</span> <span class="dt">Cell</span> <span class="ot">=</span> <span class="dt">Fixed</span> <span class="dt">Int</span> <span class="op">|</span> <span class="dt">Possible</span> [<span class="dt">Int</span>] <span class="kw">deriving</span> (<span class="dt">Show</span>, <span class="dt">Eq</span>)</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw">type</span> <span class="dt">Row</span>  <span class="ot">=</span> [<span class="dt">Cell</span>]</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="kw">type</span> <span class="dt">Grid</span> <span class="ot">=</span> [<span class="dt">Row</span>]</span></code></pre></div>
<p>A cell is either fixed with a particular digit or has a set of digits as possibilities. So it is natural to represent it as a <a href="https://en.wikipedia.org/wiki/Algebraic_data_type" target="_blank" rel="noopener">sum type</a> with <code>Fixed</code> and <code>Possible</code> constructors. A row is a list of cells and a grid is a list of rows.</p>
<p>We’ll take the input puzzle as a string of 81 characters representing the cells, left-to-right and top-to-bottom. An example is:</p>
<pre class="plain"><code>.......1.4.........2...........5.4.7..8...3....1.9....3..4..2...5.1........8.6...</code></pre>
<p>Here, <code>.</code> represents an non-filled cell. Let’s write a function to read this input and parse it to our <code>Grid</code> data structure:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb8-1"><a href="#cb8-1"></a><span class="ot">readGrid ::</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">Grid</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>readGrid s</span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="op">|</span> <span class="fu">length</span> s <span class="op">==</span> <span class="dv">81</span> <span class="ot">=</span> <span class="fu">traverse</span> (<span class="fu">traverse</span> readCell) <span class="op">.</span> Data.List.Split.chunksOf <span class="dv">9</span> <span class="op">$</span> s</span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="op">|</span> <span class="fu">otherwise</span>      <span class="ot">=</span> <span class="dt">Nothing</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>  <span class="kw">where</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>    readCell <span class="ch">'.'</span> <span class="ot">=</span> <span class="dt">Just</span> <span class="op">$</span> <span class="dt">Possible</span> [<span class="dv">1</span><span class="op">..</span><span class="dv">9</span>]</span>
<span id="cb8-7"><a href="#cb8-7"></a>    readCell c</span>
<span id="cb8-8"><a href="#cb8-8"></a>      <span class="op">|</span> Data.Char.isDigit c <span class="op">&amp;&amp;</span> c <span class="op">&gt;</span> <span class="ch">'0'</span> <span class="ot">=</span> <span class="dt">Just</span> <span class="op">.</span> <span class="dt">Fixed</span> <span class="op">.</span> Data.Char.digitToInt <span class="op">$</span> c</span>
<span id="cb8-9"><a href="#cb8-9"></a>      <span class="op">|</span> <span class="fu">otherwise</span> <span class="ot">=</span> <span class="dt">Nothing</span></span></code></pre></div>
<p><code>readGrid</code> return a <code>Just grid</code> if the input is correct, else it returns a <code>Nothing</code>. It parses a <code>.</code> to a <code>Possible</code> cell with all digits as possibilities, and a digit char to a <code>Fixed</code> cell with that digit. Let’s try it out in the <em>REPL</em>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode small haskell"><code class="sourceCode haskell"><span id="cb9-1"><a href="#cb9-1"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="dt">Just</span> grid <span class="ot">=</span> readGrid <span class="st">&quot;.......1.4.........2...........5.4.7..8...3....1.9....3..4..2...5.1........8.6...&quot;</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="fu">mapM_</span> <span class="fu">print</span> grid</span>
<span id="cb9-3"><a href="#cb9-3"></a>[<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Fixed</span> <span class="dv">1</span>,<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>]]</span>
<span id="cb9-4"><a href="#cb9-4"></a>[<span class="dt">Fixed</span> <span class="dv">4</span>,<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>]]</span>
<span id="cb9-5"><a href="#cb9-5"></a>[<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Fixed</span> <span class="dv">2</span>,<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>]]</span>
<span id="cb9-6"><a href="#cb9-6"></a>[<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Fixed</span> <span class="dv">5</span>,<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Fixed</span> <span class="dv">4</span>,<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Fixed</span> <span class="dv">7</span>]</span>
<span id="cb9-7"><a href="#cb9-7"></a>[<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Fixed</span> <span class="dv">8</span>,<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Fixed</span> <span class="dv">3</span>,<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>]]</span>
<span id="cb9-8"><a href="#cb9-8"></a>[<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Fixed</span> <span class="dv">1</span>,<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Fixed</span> <span class="dv">9</span>,<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>]]</span>
<span id="cb9-9"><a href="#cb9-9"></a>[<span class="dt">Fixed</span> <span class="dv">3</span>,<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Fixed</span> <span class="dv">4</span>,<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Fixed</span> <span class="dv">2</span>,<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>]]</span>
<span id="cb9-10"><a href="#cb9-10"></a>[<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Fixed</span> <span class="dv">5</span>,<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Fixed</span> <span class="dv">1</span>,<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>]]</span>
<span id="cb9-11"><a href="#cb9-11"></a>[<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Fixed</span> <span class="dv">8</span>,<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Fixed</span> <span class="dv">6</span>,<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>],<span class="dt">Possible</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>]]</span></code></pre></div>
<p>The output is a bit unreadable but correct. We can write a few functions to clean it up:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb10-1"><a href="#cb10-1"></a><span class="ot">showGrid ::</span> <span class="dt">Grid</span> <span class="ot">-&gt;</span> <span class="dt">String</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>showGrid <span class="ot">=</span> <span class="fu">unlines</span> <span class="op">.</span> <span class="fu">map</span> (<span class="fu">unwords</span> <span class="op">.</span> <span class="fu">map</span> showCell)</span>
<span id="cb10-3"><a href="#cb10-3"></a>  <span class="kw">where</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>    showCell (<span class="dt">Fixed</span> x) <span class="ot">=</span> <span class="fu">show</span> x</span>
<span id="cb10-5"><a href="#cb10-5"></a>    showCell _ <span class="ot">=</span> <span class="st">&quot;.&quot;</span></span>
<span id="cb10-6"><a href="#cb10-6"></a></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="ot">showGridWithPossibilities ::</span> <span class="dt">Grid</span> <span class="ot">-&gt;</span> <span class="dt">String</span></span>
<span id="cb10-8"><a href="#cb10-8"></a>showGridWithPossibilities <span class="ot">=</span> <span class="fu">unlines</span> <span class="op">.</span> <span class="fu">map</span> (<span class="fu">unwords</span> <span class="op">.</span> <span class="fu">map</span> showCell)</span>
<span id="cb10-9"><a href="#cb10-9"></a>  <span class="kw">where</span></span>
<span id="cb10-10"><a href="#cb10-10"></a>    showCell (<span class="dt">Fixed</span> x)     <span class="ot">=</span> <span class="fu">show</span> x <span class="op">++</span> <span class="st">&quot;          &quot;</span></span>
<span id="cb10-11"><a href="#cb10-11"></a>    showCell (<span class="dt">Possible</span> xs) <span class="ot">=</span></span>
<span id="cb10-12"><a href="#cb10-12"></a>      (<span class="op">++</span> <span class="st">&quot;]&quot;</span>)</span>
<span id="cb10-13"><a href="#cb10-13"></a>      <span class="op">.</span> Data.List.foldl' (\acc x <span class="ot">-&gt;</span> acc <span class="op">++</span> <span class="kw">if</span> x <span class="ot">`elem`</span> xs <span class="kw">then</span> <span class="fu">show</span> x <span class="kw">else</span> <span class="st">&quot; &quot;</span>) <span class="st">&quot;[&quot;</span></span>
<span id="cb10-14"><a href="#cb10-14"></a>      <span class="op">$</span> [<span class="dv">1</span><span class="op">..</span><span class="dv">9</span>]</span></code></pre></div>
<p>Back to the <em>REPL</em> again:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb11-1"><a href="#cb11-1"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="dt">Just</span> grid <span class="ot">=</span> readGrid <span class="st">&quot;.......1.4.........2...........5.4.7..8...3....1.9....3..4..2...5.1........8.6...&quot;</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="fu">putStrLn</span> <span class="op">$</span> showGrid grid</span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="dv">1</span> <span class="op">.</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="dv">4</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="op">.</span> <span class="dv">2</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="dv">5</span> <span class="op">.</span> <span class="dv">4</span> <span class="op">.</span> <span class="dv">7</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="op">.</span> <span class="op">.</span> <span class="dv">8</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="dv">3</span> <span class="op">.</span> <span class="op">.</span></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="op">.</span> <span class="op">.</span> <span class="dv">1</span> <span class="op">.</span> <span class="dv">9</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span></span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="dv">3</span> <span class="op">.</span> <span class="op">.</span> <span class="dv">4</span> <span class="op">.</span> <span class="op">.</span> <span class="dv">2</span> <span class="op">.</span> <span class="op">.</span></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="op">.</span> <span class="dv">5</span> <span class="op">.</span> <span class="dv">1</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="dv">8</span> <span class="op">.</span> <span class="dv">6</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode small haskell"><code class="sourceCode haskell"><span id="cb12-1"><a href="#cb12-1"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="fu">putStrLn</span> <span class="op">$</span> showGridWithPossibilities grid</span>
<span id="cb12-2"><a href="#cb12-2"></a>[<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] <span class="dv">1</span>           [<span class="dv">123456789</span>]</span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="dv">4</span>           [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>]</span>
<span id="cb12-4"><a href="#cb12-4"></a>[<span class="dv">123456789</span>] <span class="dv">2</span>           [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>]</span>
<span id="cb12-5"><a href="#cb12-5"></a>[<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] <span class="dv">5</span>           [<span class="dv">123456789</span>] <span class="dv">4</span>           [<span class="dv">123456789</span>] <span class="dv">7</span></span>
<span id="cb12-6"><a href="#cb12-6"></a>[<span class="dv">123456789</span>] [<span class="dv">123456789</span>] <span class="dv">8</span>           [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] <span class="dv">3</span>           [<span class="dv">123456789</span>] [<span class="dv">123456789</span>]</span>
<span id="cb12-7"><a href="#cb12-7"></a>[<span class="dv">123456789</span>] [<span class="dv">123456789</span>] <span class="dv">1</span>           [<span class="dv">123456789</span>] <span class="dv">9</span>           [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>]</span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="dv">3</span>           [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] <span class="dv">4</span>           [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] <span class="dv">2</span>           [<span class="dv">123456789</span>] [<span class="dv">123456789</span>]</span>
<span id="cb12-9"><a href="#cb12-9"></a>[<span class="dv">123456789</span>] <span class="dv">5</span>           [<span class="dv">123456789</span>] <span class="dv">1</span>           [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>]</span>
<span id="cb12-10"><a href="#cb12-10"></a>[<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] <span class="dv">8</span>           [<span class="dv">123456789</span>] <span class="dv">6</span>           [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>]</span></code></pre></div>
<p>The output is more readable now. We see that, at the start, all the non-filled cells have all the digits as possible values. We’ll use these functions for debugging as we go forward. We can now start solving the puzzle.</p>
<div class="page-break">

</div>
<h2 id="pruning-the-cells" data-track-content data-content-name="pruning-the-cells" data-content-piece="fast-sudoku-solver-in-haskell-1">Pruning the Cells<a href="#pruning-the-cells" class="ref-link"></a><a href="#top" class="top-link" title="Back to top"></a></h2>
<p>We can remove the digits of fixed cells from their neighboring cells, one cell as a time. But, it is faster to find all the fixed digits in a row of cells and remove them from the possibilities of all the non-fixed cells of the row, at once. Then we can repeat this <em>pruning</em> step for all the rows of the grid (and columns and sub-grids too! We’ll see how).</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb13-1"><a href="#cb13-1"></a><span class="ot">pruneCells ::</span> [<span class="dt">Cell</span>] <span class="ot">-&gt;</span> <span class="dt">Maybe</span> [<span class="dt">Cell</span>]</span>
<span id="cb13-2"><a href="#cb13-2"></a>pruneCells cells <span class="ot">=</span> <span class="fu">traverse</span> pruneCell cells</span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="kw">where</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>    fixeds <span class="ot">=</span> [x <span class="op">|</span> <span class="dt">Fixed</span> x <span class="ot">&lt;-</span> cells]</span>
<span id="cb13-5"><a href="#cb13-5"></a></span>
<span id="cb13-6"><a href="#cb13-6"></a>    pruneCell (<span class="dt">Possible</span> xs) <span class="ot">=</span> <span class="kw">case</span> xs <span class="dt">Data.List</span><span class="op">.</span>\\ fixeds <span class="kw">of</span></span>
<span id="cb13-7"><a href="#cb13-7"></a>      []  <span class="ot">-&gt;</span> <span class="dt">Nothing</span></span>
<span id="cb13-8"><a href="#cb13-8"></a>      [y] <span class="ot">-&gt;</span> <span class="dt">Just</span> <span class="op">$</span> <span class="dt">Fixed</span> y</span>
<span id="cb13-9"><a href="#cb13-9"></a>      ys  <span class="ot">-&gt;</span> <span class="dt">Just</span> <span class="op">$</span> <span class="dt">Possible</span> ys</span>
<span id="cb13-10"><a href="#cb13-10"></a>    pruneCell x <span class="ot">=</span> <span class="dt">Just</span> x</span></code></pre></div>
<p><code>pruneCells</code> prunes a list of cells as described before. We start with finding the fixed digits in the list of cells. Then we go over each non-fixed cells, removing the fixed digits we found, from their possible values. Two special cases arise:</p>
<ul>
<li>If pruning results in a cell with no possible digits, it is a sign that this branch of search has no solution and hence, we return a <code>Nothing</code> in that case.</li>
<li>If only one possible digit remains after pruning, then we turn that cell into a fixed cell with that digit.</li>
</ul>
<p>We use the <a href="https://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Traversable.html#v:traverse" target="_blank" rel="noopener"><code>traverse</code></a> function for pruning the cells so that a <code>Nothing</code> resulting from pruning one cell propagates to the entire list.</p>
<p>Let’s take it for a spin in the <em>REPL</em>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode small haskell overflow"><code class="sourceCode haskell"><span id="cb14-1"><a href="#cb14-1"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="dt">Just</span> grid <span class="ot">=</span> readGrid <span class="st">&quot;6......1.4.........2...........5.4.7..8...3....1.9....3..4..2...5.1........8.6...&quot;</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="fu">putStr</span> <span class="op">$</span> showGridWithPossibilities <span class="op">$</span> [<span class="fu">head</span> grid] <span class="co">-- first row of the grid</span></span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="dv">6</span>           [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] <span class="dv">1</span>           [<span class="dv">123456789</span>]</span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="fu">putStr</span> <span class="op">$</span> showGridWithPossibilities [fromJust <span class="op">$</span> pruneCells <span class="op">$</span> <span class="fu">head</span> grid] <span class="co">-- same row after pruning</span></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="dv">6</span>           [ <span class="dv">2345</span> <span class="dv">789</span>] [ <span class="dv">2345</span> <span class="dv">789</span>] [ <span class="dv">2345</span> <span class="dv">789</span>] [ <span class="dv">2345</span> <span class="dv">789</span>] [ <span class="dv">2345</span> <span class="dv">789</span>] [ <span class="dv">2345</span> <span class="dv">789</span>] <span class="dv">1</span>           [ <span class="dv">2345</span> <span class="dv">789</span>]</span></code></pre></div>
<p>It works! <code>6</code> and <code>1</code> are removed from the possibilities of the other cells. Now we are ready for …</p>
<h2 id="pruning-the-grid" data-track-content data-content-name="pruning-the-grid" data-content-piece="fast-sudoku-solver-in-haskell-1">Pruning the Grid<a href="#pruning-the-grid" class="ref-link"></a><a href="#top" class="top-link" title="Back to top"></a></h2>
<p>Pruning a grid requires us to prune each row, each column and each sub-grid. Let’s try to solve it in the <em>REPL</em> first:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode small haskell overflow"><code class="sourceCode haskell"><span id="cb15-1"><a href="#cb15-1"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="dt">Just</span> grid <span class="ot">=</span> readGrid <span class="st">&quot;6......1.4.........2...........5.4.7..8...3....1.9....3..4..2...5.1........8.6...&quot;</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="dt">Just</span> grid' <span class="ot">=</span> <span class="fu">traverse</span> pruneCells grid</span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="fu">putStr</span> <span class="op">$</span> showGridWithPossibilities grid'</span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="dv">6</span>           [ <span class="dv">2345</span> <span class="dv">789</span>] [ <span class="dv">2345</span> <span class="dv">789</span>] [ <span class="dv">2345</span> <span class="dv">789</span>] [ <span class="dv">2345</span> <span class="dv">789</span>] [ <span class="dv">2345</span> <span class="dv">789</span>] [ <span class="dv">2345</span> <span class="dv">789</span>] <span class="dv">1</span>           [ <span class="dv">2345</span> <span class="dv">789</span>]</span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="dv">4</span>           [<span class="dv">123</span> <span class="dv">56789</span>] [<span class="dv">123</span> <span class="dv">56789</span>] [<span class="dv">123</span> <span class="dv">56789</span>] [<span class="dv">123</span> <span class="dv">56789</span>] [<span class="dv">123</span> <span class="dv">56789</span>] [<span class="dv">123</span> <span class="dv">56789</span>] [<span class="dv">123</span> <span class="dv">56789</span>] [<span class="dv">123</span> <span class="dv">56789</span>]</span>
<span id="cb15-6"><a href="#cb15-6"></a>[<span class="dv">1</span> <span class="dv">3456789</span>] <span class="dv">2</span>           [<span class="dv">1</span> <span class="dv">3456789</span>] [<span class="dv">1</span> <span class="dv">3456789</span>] [<span class="dv">1</span> <span class="dv">3456789</span>] [<span class="dv">1</span> <span class="dv">3456789</span>] [<span class="dv">1</span> <span class="dv">3456789</span>] [<span class="dv">1</span> <span class="dv">3456789</span>] [<span class="dv">1</span> <span class="dv">3456789</span>]</span>
<span id="cb15-7"><a href="#cb15-7"></a>[<span class="dv">123</span>  <span class="dv">6</span> <span class="dv">89</span>] [<span class="dv">123</span>  <span class="dv">6</span> <span class="dv">89</span>] [<span class="dv">123</span>  <span class="dv">6</span> <span class="dv">89</span>] [<span class="dv">123</span>  <span class="dv">6</span> <span class="dv">89</span>] <span class="dv">5</span>           [<span class="dv">123</span>  <span class="dv">6</span> <span class="dv">89</span>] <span class="dv">4</span>           [<span class="dv">123</span>  <span class="dv">6</span> <span class="dv">89</span>] <span class="dv">7</span></span>
<span id="cb15-8"><a href="#cb15-8"></a>[<span class="dv">12</span> <span class="dv">4567</span> <span class="dv">9</span>] [<span class="dv">12</span> <span class="dv">4567</span> <span class="dv">9</span>] <span class="dv">8</span>           [<span class="dv">12</span> <span class="dv">4567</span> <span class="dv">9</span>] [<span class="dv">12</span> <span class="dv">4567</span> <span class="dv">9</span>] [<span class="dv">12</span> <span class="dv">4567</span> <span class="dv">9</span>] <span class="dv">3</span>           [<span class="dv">12</span> <span class="dv">4567</span> <span class="dv">9</span>] [<span class="dv">12</span> <span class="dv">4567</span> <span class="dv">9</span>]</span>
<span id="cb15-9"><a href="#cb15-9"></a>[ <span class="dv">2345678</span> ] [ <span class="dv">2345678</span> ] <span class="dv">1</span>           [ <span class="dv">2345678</span> ] <span class="dv">9</span>           [ <span class="dv">2345678</span> ] [ <span class="dv">2345678</span> ] [ <span class="dv">2345678</span> ] [ <span class="dv">2345678</span> ]</span>
<span id="cb15-10"><a href="#cb15-10"></a><span class="dv">3</span>           [<span class="dv">1</span>   <span class="dv">56789</span>] [<span class="dv">1</span>   <span class="dv">56789</span>] <span class="dv">4</span>           [<span class="dv">1</span>   <span class="dv">56789</span>] [<span class="dv">1</span>   <span class="dv">56789</span>] <span class="dv">2</span>           [<span class="dv">1</span>   <span class="dv">56789</span>] [<span class="dv">1</span>   <span class="dv">56789</span>]</span>
<span id="cb15-11"><a href="#cb15-11"></a>[ <span class="dv">234</span> <span class="dv">6789</span>] <span class="dv">5</span>           [ <span class="dv">234</span> <span class="dv">6789</span>] <span class="dv">1</span>           [ <span class="dv">234</span> <span class="dv">6789</span>] [ <span class="dv">234</span> <span class="dv">6789</span>] [ <span class="dv">234</span> <span class="dv">6789</span>] [ <span class="dv">234</span> <span class="dv">6789</span>] [ <span class="dv">234</span> <span class="dv">6789</span>]</span>
<span id="cb15-12"><a href="#cb15-12"></a>[<span class="dv">12345</span> <span class="dv">7</span> <span class="dv">9</span>] [<span class="dv">12345</span> <span class="dv">7</span> <span class="dv">9</span>] [<span class="dv">12345</span> <span class="dv">7</span> <span class="dv">9</span>] <span class="dv">8</span>           [<span class="dv">12345</span> <span class="dv">7</span> <span class="dv">9</span>] <span class="dv">6</span>           [<span class="dv">12345</span> <span class="dv">7</span> <span class="dv">9</span>] [<span class="dv">12345</span> <span class="dv">7</span> <span class="dv">9</span>] [<span class="dv">12345</span> <span class="dv">7</span> <span class="dv">9</span>]</span></code></pre></div>
<p>By <code>traverse</code>-ing the grid with <code>pruneCells</code>, we are able to prune each row, one-by-one. Since pruning a row doesn’t affect another row, we don’t have to pass the resulting rows between each pruning step. That is to say, <code>traverse</code> is enough for us, we don’t need <a href="https://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Foldable.html#v:foldl" target="_blank" rel="noopener"><code>foldl</code></a> here.</p>
<p>How do we do the same thing for columns now? Since our representation for the grid is rows-first, we first need to convert it to a columns-first representation. Luckily, that’s what <a href="https://hackage.haskell.org/package/base-4.11.1.0/docs/Data-List.html#v:transpose" target="_blank" rel="noopener"><code>Data.List.transpose</code></a> function does:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb16-1"><a href="#cb16-1"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="dt">Just</span> grid <span class="ot">=</span> readGrid <span class="st">&quot;693784512487512936125963874932651487568247391741398625319475268856129743274836159&quot;</span></span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="fu">putStr</span> <span class="op">$</span> showGrid grid</span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="dv">6</span> <span class="dv">9</span> <span class="dv">3</span> <span class="dv">7</span> <span class="dv">8</span> <span class="dv">4</span> <span class="dv">5</span> <span class="dv">1</span> <span class="dv">2</span></span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="dv">4</span> <span class="dv">8</span> <span class="dv">7</span> <span class="dv">5</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">9</span> <span class="dv">3</span> <span class="dv">6</span></span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="dv">1</span> <span class="dv">2</span> <span class="dv">5</span> <span class="dv">9</span> <span class="dv">6</span> <span class="dv">3</span> <span class="dv">8</span> <span class="dv">7</span> <span class="dv">4</span></span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="dv">9</span> <span class="dv">3</span> <span class="dv">2</span> <span class="dv">6</span> <span class="dv">5</span> <span class="dv">1</span> <span class="dv">4</span> <span class="dv">8</span> <span class="dv">7</span></span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="dv">5</span> <span class="dv">6</span> <span class="dv">8</span> <span class="dv">2</span> <span class="dv">4</span> <span class="dv">7</span> <span class="dv">3</span> <span class="dv">9</span> <span class="dv">1</span></span>
<span id="cb16-8"><a href="#cb16-8"></a><span class="dv">7</span> <span class="dv">4</span> <span class="dv">1</span> <span class="dv">3</span> <span class="dv">9</span> <span class="dv">8</span> <span class="dv">6</span> <span class="dv">2</span> <span class="dv">5</span></span>
<span id="cb16-9"><a href="#cb16-9"></a><span class="dv">3</span> <span class="dv">1</span> <span class="dv">9</span> <span class="dv">4</span> <span class="dv">7</span> <span class="dv">5</span> <span class="dv">2</span> <span class="dv">6</span> <span class="dv">8</span></span>
<span id="cb16-10"><a href="#cb16-10"></a><span class="dv">8</span> <span class="dv">5</span> <span class="dv">6</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">9</span> <span class="dv">7</span> <span class="dv">4</span> <span class="dv">3</span></span>
<span id="cb16-11"><a href="#cb16-11"></a><span class="dv">2</span> <span class="dv">7</span> <span class="dv">4</span> <span class="dv">8</span> <span class="dv">3</span> <span class="dv">6</span> <span class="dv">1</span> <span class="dv">5</span> <span class="dv">9</span></span>
<span id="cb16-12"><a href="#cb16-12"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="fu">putStr</span> <span class="op">$</span> showGrid <span class="op">$</span> Data.List.transpose grid</span>
<span id="cb16-13"><a href="#cb16-13"></a><span class="dv">6</span> <span class="dv">4</span> <span class="dv">1</span> <span class="dv">9</span> <span class="dv">5</span> <span class="dv">7</span> <span class="dv">3</span> <span class="dv">8</span> <span class="dv">2</span></span>
<span id="cb16-14"><a href="#cb16-14"></a><span class="dv">9</span> <span class="dv">8</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">6</span> <span class="dv">4</span> <span class="dv">1</span> <span class="dv">5</span> <span class="dv">7</span></span>
<span id="cb16-15"><a href="#cb16-15"></a><span class="dv">3</span> <span class="dv">7</span> <span class="dv">5</span> <span class="dv">2</span> <span class="dv">8</span> <span class="dv">1</span> <span class="dv">9</span> <span class="dv">6</span> <span class="dv">4</span></span>
<span id="cb16-16"><a href="#cb16-16"></a><span class="dv">7</span> <span class="dv">5</span> <span class="dv">9</span> <span class="dv">6</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">4</span> <span class="dv">1</span> <span class="dv">8</span></span>
<span id="cb16-17"><a href="#cb16-17"></a><span class="dv">8</span> <span class="dv">1</span> <span class="dv">6</span> <span class="dv">5</span> <span class="dv">4</span> <span class="dv">9</span> <span class="dv">7</span> <span class="dv">2</span> <span class="dv">3</span></span>
<span id="cb16-18"><a href="#cb16-18"></a><span class="dv">4</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">1</span> <span class="dv">7</span> <span class="dv">8</span> <span class="dv">5</span> <span class="dv">9</span> <span class="dv">6</span></span>
<span id="cb16-19"><a href="#cb16-19"></a><span class="dv">5</span> <span class="dv">9</span> <span class="dv">8</span> <span class="dv">4</span> <span class="dv">3</span> <span class="dv">6</span> <span class="dv">2</span> <span class="dv">7</span> <span class="dv">1</span></span>
<span id="cb16-20"><a href="#cb16-20"></a><span class="dv">1</span> <span class="dv">3</span> <span class="dv">7</span> <span class="dv">8</span> <span class="dv">9</span> <span class="dv">2</span> <span class="dv">6</span> <span class="dv">4</span> <span class="dv">5</span></span>
<span id="cb16-21"><a href="#cb16-21"></a><span class="dv">2</span> <span class="dv">6</span> <span class="dv">4</span> <span class="dv">7</span> <span class="dv">1</span> <span class="dv">5</span> <span class="dv">8</span> <span class="dv">3</span> <span class="dv">9</span></span></code></pre></div>
<p>Pruning columns is easy now:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode small haskell overflow"><code class="sourceCode haskell"><span id="cb17-1"><a href="#cb17-1"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="dt">Just</span> grid <span class="ot">=</span> readGrid <span class="st">&quot;6......1.4.........2...........5.4.7..8...3....1.9....3..4..2...5.1........8.6...&quot;</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="dt">Just</span> grid' <span class="ot">=</span> <span class="fu">fmap</span> Data.List.transpose <span class="op">.</span> <span class="fu">traverse</span> pruneCells <span class="op">.</span> Data.List.transpose <span class="op">$</span> grid</span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="fu">putStr</span> <span class="op">$</span> showGridWithPossibilities grid'</span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="dv">6</span>           [<span class="dv">1</span> <span class="dv">34</span> <span class="dv">6789</span>] [ <span class="dv">234567</span> <span class="dv">9</span>] [ <span class="dv">23</span> <span class="dv">567</span> <span class="dv">9</span>] [<span class="dv">1234</span> <span class="dv">678</span> ] [<span class="dv">12345</span> <span class="dv">789</span>] [<span class="dv">1</span>   <span class="dv">56789</span>] <span class="dv">1</span>           [<span class="dv">123456</span> <span class="dv">89</span>]</span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="dv">4</span>           [<span class="dv">1</span> <span class="dv">34</span> <span class="dv">6789</span>] [ <span class="dv">234567</span> <span class="dv">9</span>] [ <span class="dv">23</span> <span class="dv">567</span> <span class="dv">9</span>] [<span class="dv">1234</span> <span class="dv">678</span> ] [<span class="dv">12345</span> <span class="dv">789</span>] [<span class="dv">1</span>   <span class="dv">56789</span>] [ <span class="dv">23456789</span>] [<span class="dv">123456</span> <span class="dv">89</span>]</span>
<span id="cb17-6"><a href="#cb17-6"></a>[<span class="dv">12</span>  <span class="dv">5</span> <span class="dv">789</span>] <span class="dv">2</span>           [ <span class="dv">234567</span> <span class="dv">9</span>] [ <span class="dv">23</span> <span class="dv">567</span> <span class="dv">9</span>] [<span class="dv">1234</span> <span class="dv">678</span> ] [<span class="dv">12345</span> <span class="dv">789</span>] [<span class="dv">1</span>   <span class="dv">56789</span>] [ <span class="dv">23456789</span>] [<span class="dv">123456</span> <span class="dv">89</span>]</span>
<span id="cb17-7"><a href="#cb17-7"></a>[<span class="dv">12</span>  <span class="dv">5</span> <span class="dv">789</span>] [<span class="dv">1</span> <span class="dv">34</span> <span class="dv">6789</span>] [ <span class="dv">234567</span> <span class="dv">9</span>] [ <span class="dv">23</span> <span class="dv">567</span> <span class="dv">9</span>] <span class="dv">5</span>           [<span class="dv">12345</span> <span class="dv">789</span>] <span class="dv">4</span>           [ <span class="dv">23456789</span>] <span class="dv">7</span></span>
<span id="cb17-8"><a href="#cb17-8"></a>[<span class="dv">12</span>  <span class="dv">5</span> <span class="dv">789</span>] [<span class="dv">1</span> <span class="dv">34</span> <span class="dv">6789</span>] <span class="dv">8</span>           [ <span class="dv">23</span> <span class="dv">567</span> <span class="dv">9</span>] [<span class="dv">1234</span> <span class="dv">678</span> ] [<span class="dv">12345</span> <span class="dv">789</span>] <span class="dv">3</span>           [ <span class="dv">23456789</span>] [<span class="dv">123456</span> <span class="dv">89</span>]</span>
<span id="cb17-9"><a href="#cb17-9"></a>[<span class="dv">12</span>  <span class="dv">5</span> <span class="dv">789</span>] [<span class="dv">1</span> <span class="dv">34</span> <span class="dv">6789</span>] <span class="dv">1</span>           [ <span class="dv">23</span> <span class="dv">567</span> <span class="dv">9</span>] <span class="dv">9</span>           [<span class="dv">12345</span> <span class="dv">789</span>] [<span class="dv">1</span>   <span class="dv">56789</span>] [ <span class="dv">23456789</span>] [<span class="dv">123456</span> <span class="dv">89</span>]</span>
<span id="cb17-10"><a href="#cb17-10"></a><span class="dv">3</span>           [<span class="dv">1</span> <span class="dv">34</span> <span class="dv">6789</span>] [ <span class="dv">234567</span> <span class="dv">9</span>] <span class="dv">4</span>           [<span class="dv">1234</span> <span class="dv">678</span> ] [<span class="dv">12345</span> <span class="dv">789</span>] <span class="dv">2</span>           [ <span class="dv">23456789</span>] [<span class="dv">123456</span> <span class="dv">89</span>]</span>
<span id="cb17-11"><a href="#cb17-11"></a>[<span class="dv">12</span>  <span class="dv">5</span> <span class="dv">789</span>] <span class="dv">5</span>           [ <span class="dv">234567</span> <span class="dv">9</span>] <span class="dv">1</span>           [<span class="dv">1234</span> <span class="dv">678</span> ] [<span class="dv">12345</span> <span class="dv">789</span>] [<span class="dv">1</span>   <span class="dv">56789</span>] [ <span class="dv">23456789</span>] [<span class="dv">123456</span> <span class="dv">89</span>]</span>
<span id="cb17-12"><a href="#cb17-12"></a>[<span class="dv">12</span>  <span class="dv">5</span> <span class="dv">789</span>] [<span class="dv">1</span> <span class="dv">34</span> <span class="dv">6789</span>] [ <span class="dv">234567</span> <span class="dv">9</span>] <span class="dv">8</span>           [<span class="dv">1234</span> <span class="dv">678</span> ] <span class="dv">6</span>           [<span class="dv">1</span>   <span class="dv">56789</span>] [ <span class="dv">23456789</span>] [<span class="dv">123456</span> <span class="dv">89</span>]</span></code></pre></div>
<p>First, we <code>transpose</code> the grid to convert the columns into rows. Then, we prune the rows by <code>traverse</code>-ing <code>pruneCells</code> over them. And finally, we turn the rows back into columns by <code>transpose</code>-ing the grid back again. The last <code>transpose</code> needs to be <a href="https://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:fmap" target="_blank" rel="noopener"><code>fmap</code></a>-ped because <code>traverse pruneCells</code> returns a <code>Maybe</code>.</p>
<p>Pruning sub-grids is a bit trickier. Following the same idea as pruning columns, we need two functions to transform the sub-grids into rows and back. Let’s write the first one:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb18-1"><a href="#cb18-1"></a><span class="ot">subGridsToRows ::</span> <span class="dt">Grid</span> <span class="ot">-&gt;</span> <span class="dt">Grid</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>subGridsToRows <span class="ot">=</span></span>
<span id="cb18-3"><a href="#cb18-3"></a>  <span class="fu">concatMap</span> (\rows <span class="ot">-&gt;</span> <span class="kw">let</span> [r1, r2, r3] <span class="ot">=</span> <span class="fu">map</span> (Data.List.Split.chunksOf <span class="dv">3</span>) rows</span>
<span id="cb18-4"><a href="#cb18-4"></a>                      <span class="kw">in</span> <span class="fu">zipWith3</span> (\a b c <span class="ot">-&gt;</span> a <span class="op">++</span> b <span class="op">++</span> c) r1 r2 r3)</span>
<span id="cb18-5"><a href="#cb18-5"></a>  <span class="op">.</span> Data.List.Split.chunksOf <span class="dv">3</span></span></code></pre></div>
<p>And try it out:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb19-1"><a href="#cb19-1"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="dt">Just</span> grid <span class="ot">=</span> readGrid <span class="st">&quot;693784512487512936125963874932651487568247391741398625319475268856129743274836159&quot;</span></span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="fu">putStr</span> <span class="op">$</span> showGrid grid</span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="dv">6</span> <span class="dv">9</span> <span class="dv">3</span> <span class="dv">7</span> <span class="dv">8</span> <span class="dv">4</span> <span class="dv">5</span> <span class="dv">1</span> <span class="dv">2</span></span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="dv">4</span> <span class="dv">8</span> <span class="dv">7</span> <span class="dv">5</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">9</span> <span class="dv">3</span> <span class="dv">6</span></span>
<span id="cb19-5"><a href="#cb19-5"></a><span class="dv">1</span> <span class="dv">2</span> <span class="dv">5</span> <span class="dv">9</span> <span class="dv">6</span> <span class="dv">3</span> <span class="dv">8</span> <span class="dv">7</span> <span class="dv">4</span></span>
<span id="cb19-6"><a href="#cb19-6"></a><span class="dv">9</span> <span class="dv">3</span> <span class="dv">2</span> <span class="dv">6</span> <span class="dv">5</span> <span class="dv">1</span> <span class="dv">4</span> <span class="dv">8</span> <span class="dv">7</span></span>
<span id="cb19-7"><a href="#cb19-7"></a><span class="dv">5</span> <span class="dv">6</span> <span class="dv">8</span> <span class="dv">2</span> <span class="dv">4</span> <span class="dv">7</span> <span class="dv">3</span> <span class="dv">9</span> <span class="dv">1</span></span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="dv">7</span> <span class="dv">4</span> <span class="dv">1</span> <span class="dv">3</span> <span class="dv">9</span> <span class="dv">8</span> <span class="dv">6</span> <span class="dv">2</span> <span class="dv">5</span></span>
<span id="cb19-9"><a href="#cb19-9"></a><span class="dv">3</span> <span class="dv">1</span> <span class="dv">9</span> <span class="dv">4</span> <span class="dv">7</span> <span class="dv">5</span> <span class="dv">2</span> <span class="dv">6</span> <span class="dv">8</span></span>
<span id="cb19-10"><a href="#cb19-10"></a><span class="dv">8</span> <span class="dv">5</span> <span class="dv">6</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">9</span> <span class="dv">7</span> <span class="dv">4</span> <span class="dv">3</span></span>
<span id="cb19-11"><a href="#cb19-11"></a><span class="dv">2</span> <span class="dv">7</span> <span class="dv">4</span> <span class="dv">8</span> <span class="dv">3</span> <span class="dv">6</span> <span class="dv">1</span> <span class="dv">5</span> <span class="dv">9</span></span>
<span id="cb19-12"><a href="#cb19-12"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="fu">putStr</span> <span class="op">$</span> showGrid <span class="op">$</span> subGridsToRows grid</span>
<span id="cb19-13"><a href="#cb19-13"></a><span class="dv">6</span> <span class="dv">9</span> <span class="dv">3</span> <span class="dv">4</span> <span class="dv">8</span> <span class="dv">7</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">5</span></span>
<span id="cb19-14"><a href="#cb19-14"></a><span class="dv">7</span> <span class="dv">8</span> <span class="dv">4</span> <span class="dv">5</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">9</span> <span class="dv">6</span> <span class="dv">3</span></span>
<span id="cb19-15"><a href="#cb19-15"></a><span class="dv">5</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">9</span> <span class="dv">3</span> <span class="dv">6</span> <span class="dv">8</span> <span class="dv">7</span> <span class="dv">4</span></span>
<span id="cb19-16"><a href="#cb19-16"></a><span class="dv">9</span> <span class="dv">3</span> <span class="dv">2</span> <span class="dv">5</span> <span class="dv">6</span> <span class="dv">8</span> <span class="dv">7</span> <span class="dv">4</span> <span class="dv">1</span></span>
<span id="cb19-17"><a href="#cb19-17"></a><span class="dv">6</span> <span class="dv">5</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">4</span> <span class="dv">7</span> <span class="dv">3</span> <span class="dv">9</span> <span class="dv">8</span></span>
<span id="cb19-18"><a href="#cb19-18"></a><span class="dv">4</span> <span class="dv">8</span> <span class="dv">7</span> <span class="dv">3</span> <span class="dv">9</span> <span class="dv">1</span> <span class="dv">6</span> <span class="dv">2</span> <span class="dv">5</span></span>
<span id="cb19-19"><a href="#cb19-19"></a><span class="dv">3</span> <span class="dv">1</span> <span class="dv">9</span> <span class="dv">8</span> <span class="dv">5</span> <span class="dv">6</span> <span class="dv">2</span> <span class="dv">7</span> <span class="dv">4</span></span>
<span id="cb19-20"><a href="#cb19-20"></a><span class="dv">4</span> <span class="dv">7</span> <span class="dv">5</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">9</span> <span class="dv">8</span> <span class="dv">3</span> <span class="dv">6</span></span>
<span id="cb19-21"><a href="#cb19-21"></a><span class="dv">2</span> <span class="dv">6</span> <span class="dv">8</span> <span class="dv">7</span> <span class="dv">4</span> <span class="dv">3</span> <span class="dv">1</span> <span class="dv">5</span> <span class="dv">9</span></span></code></pre></div>
<p>You can go over the code and the output and make yourself sure that it works. Also, it turns out that we don’t need to write the back-transform function. <code>subGridsToRows</code> is its own back-transform:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb20-1"><a href="#cb20-1"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="fu">putStr</span> <span class="op">$</span> showGrid grid</span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="dv">6</span> <span class="dv">9</span> <span class="dv">3</span> <span class="dv">7</span> <span class="dv">8</span> <span class="dv">4</span> <span class="dv">5</span> <span class="dv">1</span> <span class="dv">2</span></span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="dv">4</span> <span class="dv">8</span> <span class="dv">7</span> <span class="dv">5</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">9</span> <span class="dv">3</span> <span class="dv">6</span></span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="dv">1</span> <span class="dv">2</span> <span class="dv">5</span> <span class="dv">9</span> <span class="dv">6</span> <span class="dv">3</span> <span class="dv">8</span> <span class="dv">7</span> <span class="dv">4</span></span>
<span id="cb20-5"><a href="#cb20-5"></a><span class="dv">9</span> <span class="dv">3</span> <span class="dv">2</span> <span class="dv">6</span> <span class="dv">5</span> <span class="dv">1</span> <span class="dv">4</span> <span class="dv">8</span> <span class="dv">7</span></span>
<span id="cb20-6"><a href="#cb20-6"></a><span class="dv">5</span> <span class="dv">6</span> <span class="dv">8</span> <span class="dv">2</span> <span class="dv">4</span> <span class="dv">7</span> <span class="dv">3</span> <span class="dv">9</span> <span class="dv">1</span></span>
<span id="cb20-7"><a href="#cb20-7"></a><span class="dv">7</span> <span class="dv">4</span> <span class="dv">1</span> <span class="dv">3</span> <span class="dv">9</span> <span class="dv">8</span> <span class="dv">6</span> <span class="dv">2</span> <span class="dv">5</span></span>
<span id="cb20-8"><a href="#cb20-8"></a><span class="dv">3</span> <span class="dv">1</span> <span class="dv">9</span> <span class="dv">4</span> <span class="dv">7</span> <span class="dv">5</span> <span class="dv">2</span> <span class="dv">6</span> <span class="dv">8</span></span>
<span id="cb20-9"><a href="#cb20-9"></a><span class="dv">8</span> <span class="dv">5</span> <span class="dv">6</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">9</span> <span class="dv">7</span> <span class="dv">4</span> <span class="dv">3</span></span>
<span id="cb20-10"><a href="#cb20-10"></a><span class="dv">2</span> <span class="dv">7</span> <span class="dv">4</span> <span class="dv">8</span> <span class="dv">3</span> <span class="dv">6</span> <span class="dv">1</span> <span class="dv">5</span> <span class="dv">9</span></span>
<span id="cb20-11"><a href="#cb20-11"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="fu">putStr</span> <span class="op">$</span> showGrid <span class="op">$</span> subGridsToRows <span class="op">$</span> subGridsToRows <span class="op">$</span> grid</span>
<span id="cb20-12"><a href="#cb20-12"></a><span class="dv">6</span> <span class="dv">9</span> <span class="dv">3</span> <span class="dv">7</span> <span class="dv">8</span> <span class="dv">4</span> <span class="dv">5</span> <span class="dv">1</span> <span class="dv">2</span></span>
<span id="cb20-13"><a href="#cb20-13"></a><span class="dv">4</span> <span class="dv">8</span> <span class="dv">7</span> <span class="dv">5</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">9</span> <span class="dv">3</span> <span class="dv">6</span></span>
<span id="cb20-14"><a href="#cb20-14"></a><span class="dv">1</span> <span class="dv">2</span> <span class="dv">5</span> <span class="dv">9</span> <span class="dv">6</span> <span class="dv">3</span> <span class="dv">8</span> <span class="dv">7</span> <span class="dv">4</span></span>
<span id="cb20-15"><a href="#cb20-15"></a><span class="dv">9</span> <span class="dv">3</span> <span class="dv">2</span> <span class="dv">6</span> <span class="dv">5</span> <span class="dv">1</span> <span class="dv">4</span> <span class="dv">8</span> <span class="dv">7</span></span>
<span id="cb20-16"><a href="#cb20-16"></a><span class="dv">5</span> <span class="dv">6</span> <span class="dv">8</span> <span class="dv">2</span> <span class="dv">4</span> <span class="dv">7</span> <span class="dv">3</span> <span class="dv">9</span> <span class="dv">1</span></span>
<span id="cb20-17"><a href="#cb20-17"></a><span class="dv">7</span> <span class="dv">4</span> <span class="dv">1</span> <span class="dv">3</span> <span class="dv">9</span> <span class="dv">8</span> <span class="dv">6</span> <span class="dv">2</span> <span class="dv">5</span></span>
<span id="cb20-18"><a href="#cb20-18"></a><span class="dv">3</span> <span class="dv">1</span> <span class="dv">9</span> <span class="dv">4</span> <span class="dv">7</span> <span class="dv">5</span> <span class="dv">2</span> <span class="dv">6</span> <span class="dv">8</span></span>
<span id="cb20-19"><a href="#cb20-19"></a><span class="dv">8</span> <span class="dv">5</span> <span class="dv">6</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">9</span> <span class="dv">7</span> <span class="dv">4</span> <span class="dv">3</span></span>
<span id="cb20-20"><a href="#cb20-20"></a><span class="dv">2</span> <span class="dv">7</span> <span class="dv">4</span> <span class="dv">8</span> <span class="dv">3</span> <span class="dv">6</span> <span class="dv">1</span> <span class="dv">5</span> <span class="dv">9</span></span></code></pre></div>
<p>Nice! Now writing the sub-grid pruning function is easy:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode small haskell overflow"><code class="sourceCode haskell"><span id="cb21-1"><a href="#cb21-1"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="dt">Just</span> grid <span class="ot">=</span> readGrid <span class="st">&quot;6......1.4.........2...........5.4.7..8...3....1.9....3..4..2...5.1........8.6...&quot;</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="dt">Just</span> grid' <span class="ot">=</span> <span class="fu">fmap</span> subGridsToRows <span class="op">.</span> <span class="fu">traverse</span> pruneCells <span class="op">.</span> subGridsToRows <span class="op">$</span> grid</span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="fu">putStr</span> <span class="op">$</span> showGridWithPossibilities grid'</span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="dv">6</span>           [<span class="dv">1</span> <span class="dv">3</span> <span class="dv">5</span> <span class="dv">789</span>] [<span class="dv">1</span> <span class="dv">3</span> <span class="dv">5</span> <span class="dv">789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [ <span class="dv">23456789</span>] <span class="dv">1</span>           [ <span class="dv">23456789</span>]</span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="dv">4</span>           [<span class="dv">1</span> <span class="dv">3</span> <span class="dv">5</span> <span class="dv">789</span>] [<span class="dv">1</span> <span class="dv">3</span> <span class="dv">5</span> <span class="dv">789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [ <span class="dv">23456789</span>] [ <span class="dv">23456789</span>] [ <span class="dv">23456789</span>]</span>
<span id="cb21-6"><a href="#cb21-6"></a>[<span class="dv">1</span> <span class="dv">3</span> <span class="dv">5</span> <span class="dv">789</span>] <span class="dv">2</span>           [<span class="dv">1</span> <span class="dv">3</span> <span class="dv">5</span> <span class="dv">789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [<span class="dv">123456789</span>] [ <span class="dv">23456789</span>] [ <span class="dv">23456789</span>] [ <span class="dv">23456789</span>]</span>
<span id="cb21-7"><a href="#cb21-7"></a>[ <span class="dv">234567</span> <span class="dv">9</span>] [ <span class="dv">234567</span> <span class="dv">9</span>] [ <span class="dv">234567</span> <span class="dv">9</span>] [<span class="dv">1234</span> <span class="dv">678</span> ] <span class="dv">5</span>           [<span class="dv">1234</span> <span class="dv">678</span> ] <span class="dv">4</span>           [<span class="dv">12</span>  <span class="dv">56</span> <span class="dv">89</span>] <span class="dv">7</span></span>
<span id="cb21-8"><a href="#cb21-8"></a>[ <span class="dv">234567</span> <span class="dv">9</span>] [ <span class="dv">234567</span> <span class="dv">9</span>] <span class="dv">8</span>           [<span class="dv">1234</span> <span class="dv">678</span> ] [<span class="dv">1234</span> <span class="dv">678</span> ] [<span class="dv">1234</span> <span class="dv">678</span> ] <span class="dv">3</span>           [<span class="dv">12</span>  <span class="dv">56</span> <span class="dv">89</span>] [<span class="dv">12</span>  <span class="dv">56</span> <span class="dv">89</span>]</span>
<span id="cb21-9"><a href="#cb21-9"></a>[ <span class="dv">234567</span> <span class="dv">9</span>] [ <span class="dv">234567</span> <span class="dv">9</span>] <span class="dv">1</span>           [<span class="dv">1234</span> <span class="dv">678</span> ] <span class="dv">9</span>           [<span class="dv">1234</span> <span class="dv">678</span> ] [<span class="dv">12</span>  <span class="dv">56</span> <span class="dv">89</span>] [<span class="dv">12</span>  <span class="dv">56</span> <span class="dv">89</span>] [<span class="dv">12</span>  <span class="dv">56</span> <span class="dv">89</span>]</span>
<span id="cb21-10"><a href="#cb21-10"></a><span class="dv">3</span>           [<span class="dv">12</span> <span class="dv">4</span> <span class="dv">6789</span>] [<span class="dv">12</span> <span class="dv">4</span> <span class="dv">6789</span>] <span class="dv">4</span>           [ <span class="dv">23</span> <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [ <span class="dv">23</span> <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] <span class="dv">2</span>           [<span class="dv">1</span> <span class="dv">3456789</span>] [<span class="dv">1</span> <span class="dv">3456789</span>]</span>
<span id="cb21-11"><a href="#cb21-11"></a>[<span class="dv">12</span> <span class="dv">4</span> <span class="dv">6789</span>] <span class="dv">5</span>           [<span class="dv">12</span> <span class="dv">4</span> <span class="dv">6789</span>] <span class="dv">1</span>           [ <span class="dv">23</span> <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [ <span class="dv">23</span> <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [<span class="dv">1</span> <span class="dv">3456789</span>] [<span class="dv">1</span> <span class="dv">3456789</span>] [<span class="dv">1</span> <span class="dv">3456789</span>]</span>
<span id="cb21-12"><a href="#cb21-12"></a>[<span class="dv">12</span> <span class="dv">4</span> <span class="dv">6789</span>] [<span class="dv">12</span> <span class="dv">4</span> <span class="dv">6789</span>] [<span class="dv">12</span> <span class="dv">4</span> <span class="dv">6789</span>] <span class="dv">8</span>           [ <span class="dv">23</span> <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] <span class="dv">6</span>           [<span class="dv">1</span> <span class="dv">3456789</span>] [<span class="dv">1</span> <span class="dv">3456789</span>] [<span class="dv">1</span> <span class="dv">3456789</span>]</span></code></pre></div>
<p>It works well. Now we can string together these three steps to prune the entire grid. We also have to make sure that result of pruning each step is fed into the next step. This is so that the fixed cells created into one step cause more pruning in the further steps. We use monadic bind (<a href="https://hackage.haskell.org/package/base-4.10.1.0/docs/Control-Monad.html#v:-62--62--61-" target="_blank" rel="noopener"><code>&gt;&gt;=</code></a>) for that. Here’s the final code:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb22-1"><a href="#cb22-1"></a><span class="ot">pruneGrid' ::</span> <span class="dt">Grid</span> <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">Grid</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>pruneGrid' grid <span class="ot">=</span></span>
<span id="cb22-3"><a href="#cb22-3"></a>  <span class="fu">traverse</span> pruneCells grid</span>
<span id="cb22-4"><a href="#cb22-4"></a>  <span class="op">&gt;&gt;=</span> <span class="fu">fmap</span> Data.List.transpose <span class="op">.</span> <span class="fu">traverse</span> pruneCells <span class="op">.</span> Data.List.transpose</span>
<span id="cb22-5"><a href="#cb22-5"></a>  <span class="op">&gt;&gt;=</span> <span class="fu">fmap</span> subGridsToRows <span class="op">.</span> <span class="fu">traverse</span> pruneCells <span class="op">.</span> subGridsToRows</span></code></pre></div>
<p>And the test:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode small haskell overflow"><code class="sourceCode haskell"><span id="cb23-1"><a href="#cb23-1"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="dt">Just</span> grid <span class="ot">=</span> readGrid <span class="st">&quot;6......1.4.........2...........5.4.7..8...3....1.9....3..4..2...5.1........8.6...&quot;</span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="dt">Just</span> grid' <span class="ot">=</span> pruneGrid' grid</span>
<span id="cb23-3"><a href="#cb23-3"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="fu">putStr</span> <span class="op">$</span> showGridWithPossibilities grid'</span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="dv">6</span>           [  <span class="dv">3</span>   <span class="dv">789</span>] [  <span class="dv">3</span> <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [ <span class="dv">23</span> <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [ <span class="dv">234</span>  <span class="dv">78</span> ] [ <span class="dv">2345</span> <span class="dv">789</span>] [    <span class="dv">5</span> <span class="dv">789</span>] <span class="dv">1</span>           [ <span class="dv">2345</span>  <span class="dv">89</span>]</span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="dv">4</span>           [<span class="dv">1</span> <span class="dv">3</span>   <span class="dv">789</span>] [  <span class="dv">3</span> <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [ <span class="dv">23</span> <span class="dv">567</span> <span class="dv">9</span>] [<span class="dv">123</span>  <span class="dv">678</span> ] [<span class="dv">123</span> <span class="dv">5</span> <span class="dv">789</span>] [    <span class="dv">56789</span>] [ <span class="dv">23</span> <span class="dv">56789</span>] [ <span class="dv">23</span> <span class="dv">56</span> <span class="dv">89</span>]</span>
<span id="cb23-6"><a href="#cb23-6"></a>[<span class="dv">1</span>   <span class="dv">5</span> <span class="dv">789</span>] <span class="dv">2</span>           [  <span class="dv">3</span> <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [  <span class="dv">3</span> <span class="dv">567</span> <span class="dv">9</span>] [<span class="dv">1</span> <span class="dv">34</span> <span class="dv">678</span> ] [<span class="dv">1</span> <span class="dv">345</span> <span class="dv">789</span>] [    <span class="dv">56789</span>] [  <span class="dv">3456789</span>] [  <span class="dv">3456</span> <span class="dv">89</span>]</span>
<span id="cb23-7"><a href="#cb23-7"></a>[ <span class="dv">2</span>      <span class="dv">9</span>] [  <span class="dv">3</span>  <span class="dv">6</span>  <span class="dv">9</span>] [ <span class="dv">23</span>  <span class="dv">6</span>  <span class="dv">9</span>] [ <span class="dv">23</span>  <span class="dv">6</span>   ] <span class="dv">5</span>           [<span class="dv">123</span>    <span class="dv">8</span> ] <span class="dv">4</span>           [ <span class="dv">2</span>   <span class="dv">6</span> <span class="dv">89</span>] <span class="dv">7</span></span>
<span id="cb23-8"><a href="#cb23-8"></a>[ <span class="dv">2</span>  <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [   <span class="dv">4</span> <span class="dv">67</span> <span class="dv">9</span>] <span class="dv">8</span>           [ <span class="dv">2</span>   <span class="dv">67</span>  ] [<span class="dv">12</span> <span class="dv">4</span> <span class="dv">67</span>  ] [<span class="dv">12</span> <span class="dv">4</span>  <span class="dv">7</span>  ] <span class="dv">3</span>           [ <span class="dv">2</span>  <span class="dv">56</span>  <span class="dv">9</span>] [<span class="dv">12</span>  <span class="dv">56</span>  <span class="dv">9</span>]</span>
<span id="cb23-9"><a href="#cb23-9"></a>[ <span class="dv">2</span>  <span class="dv">5</span> <span class="dv">7</span>  ] [  <span class="dv">34</span> <span class="dv">67</span>  ] <span class="dv">1</span>           [ <span class="dv">23</span>  <span class="dv">67</span>  ] <span class="dv">9</span>           [ <span class="dv">234</span>  <span class="dv">78</span> ] [    <span class="dv">56</span> <span class="dv">8</span> ] [ <span class="dv">2</span>  <span class="dv">56</span> <span class="dv">8</span> ] [ <span class="dv">2</span>  <span class="dv">56</span> <span class="dv">8</span> ]</span>
<span id="cb23-10"><a href="#cb23-10"></a><span class="dv">3</span>           [<span class="dv">1</span>    <span class="dv">6789</span>] [     <span class="dv">67</span> <span class="dv">9</span>] <span class="dv">4</span>           <span class="dv">7</span>           [    <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] <span class="dv">2</span>           [    <span class="dv">56789</span>] [<span class="dv">1</span>   <span class="dv">56</span> <span class="dv">89</span>]</span>
<span id="cb23-11"><a href="#cb23-11"></a>[ <span class="dv">2</span>    <span class="dv">789</span>] <span class="dv">5</span>           [ <span class="dv">2</span> <span class="dv">4</span> <span class="dv">67</span> <span class="dv">9</span>] <span class="dv">1</span>           [ <span class="dv">23</span>   <span class="dv">7</span>  ] [ <span class="dv">23</span>   <span class="dv">7</span> <span class="dv">9</span>] [     <span class="dv">6789</span>] [  <span class="dv">34</span> <span class="dv">6789</span>] [  <span class="dv">34</span> <span class="dv">6</span> <span class="dv">89</span>]</span>
<span id="cb23-12"><a href="#cb23-12"></a>[<span class="dv">12</span>    <span class="dv">7</span> <span class="dv">9</span>] [<span class="dv">1</span>  <span class="dv">4</span>  <span class="dv">7</span> <span class="dv">9</span>] [ <span class="dv">2</span> <span class="dv">4</span>  <span class="dv">7</span> <span class="dv">9</span>] <span class="dv">8</span>           [ <span class="dv">23</span>   <span class="dv">7</span>  ] <span class="dv">6</span>           [<span class="dv">1</span>   <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [  <span class="dv">345</span> <span class="dv">7</span> <span class="dv">9</span>] [<span class="dv">1</span> <span class="dv">345</span>   <span class="dv">9</span>]</span>
<span id="cb23-13"><a href="#cb23-13"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="fu">putStr</span> <span class="op">$</span> showGrid grid</span>
<span id="cb23-14"><a href="#cb23-14"></a><span class="dv">6</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="dv">1</span> <span class="op">.</span></span>
<span id="cb23-15"><a href="#cb23-15"></a><span class="dv">4</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span></span>
<span id="cb23-16"><a href="#cb23-16"></a><span class="op">.</span> <span class="dv">2</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span></span>
<span id="cb23-17"><a href="#cb23-17"></a><span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="dv">5</span> <span class="op">.</span> <span class="dv">4</span> <span class="op">.</span> <span class="dv">7</span></span>
<span id="cb23-18"><a href="#cb23-18"></a><span class="op">.</span> <span class="op">.</span> <span class="dv">8</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="dv">3</span> <span class="op">.</span> <span class="op">.</span></span>
<span id="cb23-19"><a href="#cb23-19"></a><span class="op">.</span> <span class="op">.</span> <span class="dv">1</span> <span class="op">.</span> <span class="dv">9</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span></span>
<span id="cb23-20"><a href="#cb23-20"></a><span class="dv">3</span> <span class="op">.</span> <span class="op">.</span> <span class="dv">4</span> <span class="op">.</span> <span class="op">.</span> <span class="dv">2</span> <span class="op">.</span> <span class="op">.</span></span>
<span id="cb23-21"><a href="#cb23-21"></a><span class="op">.</span> <span class="dv">5</span> <span class="op">.</span> <span class="dv">1</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span></span>
<span id="cb23-22"><a href="#cb23-22"></a><span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="dv">8</span> <span class="op">.</span> <span class="dv">6</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span></span>
<span id="cb23-23"><a href="#cb23-23"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="fu">putStr</span> <span class="op">$</span> showGrid grid'</span>
<span id="cb23-24"><a href="#cb23-24"></a><span class="dv">6</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="dv">1</span> <span class="op">.</span></span>
<span id="cb23-25"><a href="#cb23-25"></a><span class="dv">4</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span></span>
<span id="cb23-26"><a href="#cb23-26"></a><span class="op">.</span> <span class="dv">2</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span></span>
<span id="cb23-27"><a href="#cb23-27"></a><span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="dv">5</span> <span class="op">.</span> <span class="dv">4</span> <span class="op">.</span> <span class="dv">7</span></span>
<span id="cb23-28"><a href="#cb23-28"></a><span class="op">.</span> <span class="op">.</span> <span class="dv">8</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="dv">3</span> <span class="op">.</span> <span class="op">.</span></span>
<span id="cb23-29"><a href="#cb23-29"></a><span class="op">.</span> <span class="op">.</span> <span class="dv">1</span> <span class="op">.</span> <span class="dv">9</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span></span>
<span id="cb23-30"><a href="#cb23-30"></a><span class="dv">3</span> <span class="op">.</span> <span class="op">.</span> <span class="dv">4</span> <span class="dv">7</span> <span class="op">.</span> <span class="dv">2</span> <span class="op">.</span> <span class="op">.</span></span>
<span id="cb23-31"><a href="#cb23-31"></a><span class="op">.</span> <span class="dv">5</span> <span class="op">.</span> <span class="dv">1</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span></span>
<span id="cb23-32"><a href="#cb23-32"></a><span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="dv">8</span> <span class="op">.</span> <span class="dv">6</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span></span></code></pre></div>
<p>We can clearly see the massive pruning of possibilities all around the grid. We also see a <code>7</code> pop up in the row-7-column-5 cell. This means that we can prune the grid further, until it settles. If you are familiar with Haskell, you may recognize this as trying to find a <a href="https://en.wikipedia.org/wiki/Fixed_point_%28mathematics%29" target="_blank" rel="noopener">fixed point</a> for the <code>pruneGrid'</code> function, except in a monadic context. It is simple to implement:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb24-1"><a href="#cb24-1"></a><span class="ot">pruneGrid ::</span> <span class="dt">Grid</span> <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">Grid</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>pruneGrid <span class="ot">=</span> fixM pruneGrid'</span>
<span id="cb24-3"><a href="#cb24-3"></a>  <span class="kw">where</span></span>
<span id="cb24-4"><a href="#cb24-4"></a>    fixM f x <span class="ot">=</span> f x <span class="op">&gt;&gt;=</span> \x' <span class="ot">-&gt;</span> <span class="kw">if</span> x' <span class="op">==</span> x <span class="kw">then</span> <span class="fu">return</span> x <span class="kw">else</span> fixM f x'</span></code></pre></div>
<p>The crux of this code is the <code>fixM</code> function. It takes a monadic function <code>f</code> and an initial value, and recursively calls itself till the return value settles. Let’s do another round in the <em>REPL</em>:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode small haskell overflow"><code class="sourceCode haskell"><span id="cb25-1"><a href="#cb25-1"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="dt">Just</span> grid <span class="ot">=</span> readGrid <span class="st">&quot;6......1.4.........2...........5.4.7..8...3....1.9....3..4..2...5.1........8.6...&quot;</span></span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="dt">Just</span> grid' <span class="ot">=</span> pruneGrid grid</span>
<span id="cb25-3"><a href="#cb25-3"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="fu">putStr</span> <span class="op">$</span> showGridWithPossibilities grid'</span>
<span id="cb25-4"><a href="#cb25-4"></a><span class="dv">6</span>           [  <span class="dv">3</span>   <span class="dv">789</span>] [  <span class="dv">3</span> <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [ <span class="dv">23</span> <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [ <span class="dv">234</span>   <span class="dv">8</span> ] [ <span class="dv">2345</span> <span class="dv">789</span>] [    <span class="dv">5</span> <span class="dv">789</span>] <span class="dv">1</span>           [ <span class="dv">2345</span>  <span class="dv">89</span>]</span>
<span id="cb25-5"><a href="#cb25-5"></a><span class="dv">4</span>           [<span class="dv">1</span> <span class="dv">3</span>   <span class="dv">789</span>] [  <span class="dv">3</span> <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [ <span class="dv">23</span> <span class="dv">567</span> <span class="dv">9</span>] [<span class="dv">123</span>  <span class="dv">6</span> <span class="dv">8</span> ] [<span class="dv">123</span> <span class="dv">5</span> <span class="dv">789</span>] [    <span class="dv">56789</span>] [ <span class="dv">23</span> <span class="dv">56789</span>] [ <span class="dv">23</span> <span class="dv">56</span> <span class="dv">89</span>]</span>
<span id="cb25-6"><a href="#cb25-6"></a>[<span class="dv">1</span>   <span class="dv">5</span> <span class="dv">789</span>] <span class="dv">2</span>           [  <span class="dv">3</span> <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [  <span class="dv">3</span> <span class="dv">567</span> <span class="dv">9</span>] [<span class="dv">1</span> <span class="dv">34</span> <span class="dv">6</span> <span class="dv">8</span> ] [<span class="dv">1</span> <span class="dv">345</span> <span class="dv">789</span>] [    <span class="dv">56789</span>] [  <span class="dv">3456789</span>] [  <span class="dv">3456</span> <span class="dv">89</span>]</span>
<span id="cb25-7"><a href="#cb25-7"></a>[ <span class="dv">2</span>      <span class="dv">9</span>] [  <span class="dv">3</span>  <span class="dv">6</span>  <span class="dv">9</span>] [ <span class="dv">23</span>  <span class="dv">6</span>  <span class="dv">9</span>] [ <span class="dv">23</span>  <span class="dv">6</span>   ] <span class="dv">5</span>           [<span class="dv">123</span>    <span class="dv">8</span> ] <span class="dv">4</span>           [ <span class="dv">2</span>   <span class="dv">6</span> <span class="dv">89</span>] <span class="dv">7</span></span>
<span id="cb25-8"><a href="#cb25-8"></a>[ <span class="dv">2</span>  <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [   <span class="dv">4</span> <span class="dv">67</span> <span class="dv">9</span>] <span class="dv">8</span>           [ <span class="dv">2</span>   <span class="dv">67</span>  ] [<span class="dv">12</span> <span class="dv">4</span> <span class="dv">6</span>   ] [<span class="dv">12</span> <span class="dv">4</span>  <span class="dv">7</span>  ] <span class="dv">3</span>           [ <span class="dv">2</span>  <span class="dv">56</span>  <span class="dv">9</span>] [<span class="dv">12</span>  <span class="dv">56</span>  <span class="dv">9</span>]</span>
<span id="cb25-9"><a href="#cb25-9"></a>[ <span class="dv">2</span>  <span class="dv">5</span> <span class="dv">7</span>  ] [  <span class="dv">34</span> <span class="dv">67</span>  ] <span class="dv">1</span>           [ <span class="dv">23</span>  <span class="dv">67</span>  ] <span class="dv">9</span>           [ <span class="dv">234</span>  <span class="dv">78</span> ] [    <span class="dv">56</span> <span class="dv">8</span> ] [ <span class="dv">2</span>  <span class="dv">56</span> <span class="dv">8</span> ] [ <span class="dv">2</span>  <span class="dv">56</span> <span class="dv">8</span> ]</span>
<span id="cb25-10"><a href="#cb25-10"></a><span class="dv">3</span>           [<span class="dv">1</span>    <span class="dv">6</span> <span class="dv">89</span>] [     <span class="dv">6</span>  <span class="dv">9</span>] <span class="dv">4</span>           <span class="dv">7</span>           [    <span class="dv">5</span>   <span class="dv">9</span>] <span class="dv">2</span>           [    <span class="dv">56</span> <span class="dv">89</span>] [<span class="dv">1</span>   <span class="dv">56</span> <span class="dv">89</span>]</span>
<span id="cb25-11"><a href="#cb25-11"></a>[ <span class="dv">2</span>    <span class="dv">789</span>] <span class="dv">5</span>           [ <span class="dv">2</span> <span class="dv">4</span> <span class="dv">67</span> <span class="dv">9</span>] <span class="dv">1</span>           [ <span class="dv">23</span>      ] [ <span class="dv">23</span>     <span class="dv">9</span>] [     <span class="dv">6789</span>] [  <span class="dv">34</span> <span class="dv">6789</span>] [  <span class="dv">34</span> <span class="dv">6</span> <span class="dv">89</span>]</span>
<span id="cb25-12"><a href="#cb25-12"></a>[<span class="dv">12</span>    <span class="dv">7</span> <span class="dv">9</span>] [<span class="dv">1</span>  <span class="dv">4</span>  <span class="dv">7</span> <span class="dv">9</span>] [ <span class="dv">2</span> <span class="dv">4</span>  <span class="dv">7</span> <span class="dv">9</span>] <span class="dv">8</span>           [ <span class="dv">23</span>      ] <span class="dv">6</span>           [<span class="dv">1</span>   <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [  <span class="dv">345</span> <span class="dv">7</span> <span class="dv">9</span>] [<span class="dv">1</span> <span class="dv">345</span>   <span class="dv">9</span>]</span></code></pre></div>
<p>We see that <code>7</code> in the row-7-column-5 cell is eliminated from all its neighboring cells. We can’t prune the grid anymore. Now it is time to make the choice.</p>
<h2 id="making-the-choice" data-track-content data-content-name="making-the-choice" data-content-piece="fast-sudoku-solver-in-haskell-1">Making the Choice<a href="#making-the-choice" class="ref-link"></a><a href="#top" class="top-link" title="Back to top"></a></h2>
<p>One the grid is settled, we need to choose a non-fixed cell and make it fixed by assuming one of its possible values. This gives us two grids, next in the state-space of the solution search:</p>
<ul>
<li>one which has this chosen cell fixed to this chosen digit, and,</li>
<li>the other in which the chosen cell has all the other possibilities except the one we chose to fix.</li>
</ul>
<p>We call this function, <code>nextGrids</code>:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb26-1"><a href="#cb26-1"></a><span class="ot">nextGrids ::</span> <span class="dt">Grid</span> <span class="ot">-&gt;</span> (<span class="dt">Grid</span>, <span class="dt">Grid</span>)</span>
<span id="cb26-2"><a href="#cb26-2"></a>nextGrids grid <span class="ot">=</span></span>
<span id="cb26-3"><a href="#cb26-3"></a>  <span class="kw">let</span> (i, first<span class="op">@</span>(<span class="dt">Fixed</span> _), rest) <span class="ot">=</span></span>
<span id="cb26-4"><a href="#cb26-4"></a>        fixCell</span>
<span id="cb26-5"><a href="#cb26-5"></a>        <span class="op">.</span> Data.List.minimumBy (<span class="fu">compare</span> <span class="ot">`Data.Function.on`</span> (possibilityCount <span class="op">.</span> <span class="fu">snd</span>))</span>
<span id="cb26-6"><a href="#cb26-6"></a>        <span class="op">.</span> <span class="fu">filter</span> (isPossible <span class="op">.</span> <span class="fu">snd</span>)</span>
<span id="cb26-7"><a href="#cb26-7"></a>        <span class="op">.</span> <span class="fu">zip</span> [<span class="dv">0</span><span class="op">..</span>]</span>
<span id="cb26-8"><a href="#cb26-8"></a>        <span class="op">.</span> <span class="fu">concat</span></span>
<span id="cb26-9"><a href="#cb26-9"></a>        <span class="op">$</span> grid</span>
<span id="cb26-10"><a href="#cb26-10"></a>  <span class="kw">in</span> (replace2D i first grid, replace2D i rest grid)</span>
<span id="cb26-11"><a href="#cb26-11"></a>  <span class="kw">where</span></span>
<span id="cb26-12"><a href="#cb26-12"></a>    isPossible (<span class="dt">Possible</span> _) <span class="ot">=</span> <span class="dt">True</span></span>
<span id="cb26-13"><a href="#cb26-13"></a>    isPossible _            <span class="ot">=</span> <span class="dt">False</span></span>
<span id="cb26-14"><a href="#cb26-14"></a></span>
<span id="cb26-15"><a href="#cb26-15"></a>    possibilityCount (<span class="dt">Possible</span> xs) <span class="ot">=</span> <span class="fu">length</span> xs</span>
<span id="cb26-16"><a href="#cb26-16"></a>    possibilityCount (<span class="dt">Fixed</span> _)     <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb26-17"><a href="#cb26-17"></a></span>
<span id="cb26-18"><a href="#cb26-18"></a>    fixCell (i, <span class="dt">Possible</span> [x, y]) <span class="ot">=</span> (i, <span class="dt">Fixed</span> x, <span class="dt">Fixed</span> y)</span>
<span id="cb26-19"><a href="#cb26-19"></a>    fixCell (i, <span class="dt">Possible</span> (x<span class="op">:</span>xs)) <span class="ot">=</span> (i, <span class="dt">Fixed</span> x, <span class="dt">Possible</span> xs)</span>
<span id="cb26-20"><a href="#cb26-20"></a>    fixCell _                    <span class="ot">=</span> <span class="fu">error</span> <span class="st">&quot;Impossible case&quot;</span></span>
<span id="cb26-21"><a href="#cb26-21"></a></span>
<span id="cb26-22"><a href="#cb26-22"></a><span class="ot">    replace2D ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> a <span class="ot">-&gt;</span> [[a]] <span class="ot">-&gt;</span> [[a]]</span>
<span id="cb26-23"><a href="#cb26-23"></a>    replace2D i v <span class="ot">=</span></span>
<span id="cb26-24"><a href="#cb26-24"></a>      <span class="kw">let</span> (x, y) <span class="ot">=</span> (i <span class="ot">`quot`</span> <span class="dv">9</span>, i <span class="ot">`mod`</span> <span class="dv">9</span>) <span class="kw">in</span> replace x (replace y (<span class="fu">const</span> v))</span>
<span id="cb26-25"><a href="#cb26-25"></a>    replace p f xs <span class="ot">=</span> [<span class="kw">if</span> i <span class="op">==</span> p <span class="kw">then</span> f x <span class="kw">else</span> x <span class="op">|</span> (x, i) <span class="ot">&lt;-</span> <span class="fu">zip</span> xs [<span class="dv">0</span><span class="op">..</span>]]</span></code></pre></div>
<p>We choose the non-fixed cell with least count of possibilities as the pivot. This strategy make sense intuitively, as with a cell with fewest possibilities, we have the most chance of being right when assuming one. Fixing a non-fixed cell leads to one of the two cases:</p>
<ol type="a">
<li>the cell has only two possible values, resulting in two fixed cells, or,</li>
<li>the cell has more than two possible values, resulting in one fixed and one non-fixed cell.</li>
</ol>
<p>Then all we are left with is replacing the non-fixed cell with its fixed and fixed/non-fixed choices, which we do with some math and some list traversal. A quick check on the <em>REPL</em>:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode small haskell overflow"><code class="sourceCode haskell"><span id="cb27-1"><a href="#cb27-1"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="dt">Just</span> grid <span class="ot">=</span> readGrid <span class="st">&quot;6......1.4.........2...........5.4.7..8...3....1.9....3..4..2...5.1........8.6...&quot;</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="dt">Just</span> grid' <span class="ot">=</span> pruneGrid grid</span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="fu">putStr</span> <span class="op">$</span> showGridWithPossibilities grid'</span>
<span id="cb27-4"><a href="#cb27-4"></a><span class="dv">6</span>           [  <span class="dv">3</span>   <span class="dv">789</span>] [  <span class="dv">3</span> <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [ <span class="dv">23</span> <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [ <span class="dv">234</span>   <span class="dv">8</span> ] [ <span class="dv">2345</span> <span class="dv">789</span>] [    <span class="dv">5</span> <span class="dv">789</span>] <span class="dv">1</span>           [ <span class="dv">2345</span>  <span class="dv">89</span>]</span>
<span id="cb27-5"><a href="#cb27-5"></a><span class="dv">4</span>           [<span class="dv">1</span> <span class="dv">3</span>   <span class="dv">789</span>] [  <span class="dv">3</span> <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [ <span class="dv">23</span> <span class="dv">567</span> <span class="dv">9</span>] [<span class="dv">123</span>  <span class="dv">6</span> <span class="dv">8</span> ] [<span class="dv">123</span> <span class="dv">5</span> <span class="dv">789</span>] [    <span class="dv">56789</span>] [ <span class="dv">23</span> <span class="dv">56789</span>] [ <span class="dv">23</span> <span class="dv">56</span> <span class="dv">89</span>]</span>
<span id="cb27-6"><a href="#cb27-6"></a>[<span class="dv">1</span>   <span class="dv">5</span> <span class="dv">789</span>] <span class="dv">2</span>           [  <span class="dv">3</span> <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [  <span class="dv">3</span> <span class="dv">567</span> <span class="dv">9</span>] [<span class="dv">1</span> <span class="dv">34</span> <span class="dv">6</span> <span class="dv">8</span> ] [<span class="dv">1</span> <span class="dv">345</span> <span class="dv">789</span>] [    <span class="dv">56789</span>] [  <span class="dv">3456789</span>] [  <span class="dv">3456</span> <span class="dv">89</span>]</span>
<span id="cb27-7"><a href="#cb27-7"></a>[ <span class="dv">2</span>      <span class="dv">9</span>] [  <span class="dv">3</span>  <span class="dv">6</span>  <span class="dv">9</span>] [ <span class="dv">23</span>  <span class="dv">6</span>  <span class="dv">9</span>] [ <span class="dv">23</span>  <span class="dv">6</span>   ] <span class="dv">5</span>           [<span class="dv">123</span>    <span class="dv">8</span> ] <span class="dv">4</span>           [ <span class="dv">2</span>   <span class="dv">6</span> <span class="dv">89</span>] <span class="dv">7</span></span>
<span id="cb27-8"><a href="#cb27-8"></a>[ <span class="dv">2</span>  <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [   <span class="dv">4</span> <span class="dv">67</span> <span class="dv">9</span>] <span class="dv">8</span>           [ <span class="dv">2</span>   <span class="dv">67</span>  ] [<span class="dv">12</span> <span class="dv">4</span> <span class="dv">6</span>   ] [<span class="dv">12</span> <span class="dv">4</span>  <span class="dv">7</span>  ] <span class="dv">3</span>           [ <span class="dv">2</span>  <span class="dv">56</span>  <span class="dv">9</span>] [<span class="dv">12</span>  <span class="dv">56</span>  <span class="dv">9</span>]</span>
<span id="cb27-9"><a href="#cb27-9"></a>[ <span class="dv">2</span>  <span class="dv">5</span> <span class="dv">7</span>  ] [  <span class="dv">34</span> <span class="dv">67</span>  ] <span class="dv">1</span>           [ <span class="dv">23</span>  <span class="dv">67</span>  ] <span class="dv">9</span>           [ <span class="dv">234</span>  <span class="dv">78</span> ] [    <span class="dv">56</span> <span class="dv">8</span> ] [ <span class="dv">2</span>  <span class="dv">56</span> <span class="dv">8</span> ] [ <span class="dv">2</span>  <span class="dv">56</span> <span class="dv">8</span> ]</span>
<span id="cb27-10"><a href="#cb27-10"></a><span class="dv">3</span>           [<span class="dv">1</span>    <span class="dv">6</span> <span class="dv">89</span>] [     <span class="dv">6</span>  <span class="dv">9</span>] <span class="dv">4</span>           <span class="dv">7</span>           [    <span class="dv">5</span>   <span class="dv">9</span>] <span class="dv">2</span>           [    <span class="dv">56</span> <span class="dv">89</span>] [<span class="dv">1</span>   <span class="dv">56</span> <span class="dv">89</span>]</span>
<span id="cb27-11"><a href="#cb27-11"></a>[ <span class="dv">2</span>    <span class="dv">789</span>] <span class="dv">5</span>           [ <span class="dv">2</span> <span class="dv">4</span> <span class="dv">67</span> <span class="dv">9</span>] <span class="dv">1</span>           [ <span class="dv">23</span>      ] [ <span class="dv">23</span>     <span class="dv">9</span>] [     <span class="dv">6789</span>] [  <span class="dv">34</span> <span class="dv">6789</span>] [  <span class="dv">34</span> <span class="dv">6</span> <span class="dv">89</span>]</span>
<span id="cb27-12"><a href="#cb27-12"></a>[<span class="dv">12</span>    <span class="dv">7</span> <span class="dv">9</span>] [<span class="dv">1</span>  <span class="dv">4</span>  <span class="dv">7</span> <span class="dv">9</span>] [ <span class="dv">2</span> <span class="dv">4</span>  <span class="dv">7</span> <span class="dv">9</span>] <span class="dv">8</span>           [ <span class="dv">23</span>      ] <span class="dv">6</span>           [<span class="dv">1</span>   <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [  <span class="dv">345</span> <span class="dv">7</span> <span class="dv">9</span>] [<span class="dv">1</span> <span class="dv">345</span>   <span class="dv">9</span>]</span>
<span id="cb27-13"><a href="#cb27-13"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="co">-- the row-4-column-1 cell is the first cell with only two possibilities, [2, 9].</span></span>
<span id="cb27-14"><a href="#cb27-14"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="co">-- it is chosen as the pivot cell to find the next grids.</span></span>
<span id="cb27-15"><a href="#cb27-15"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> (grid1, grid2) <span class="ot">=</span> nextGrids grid'</span>
<span id="cb27-16"><a href="#cb27-16"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="fu">putStr</span> <span class="op">$</span> showGridWithPossibilities grid1</span>
<span id="cb27-17"><a href="#cb27-17"></a><span class="dv">6</span>           [  <span class="dv">3</span>   <span class="dv">789</span>] [  <span class="dv">3</span> <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [ <span class="dv">23</span> <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [ <span class="dv">234</span>   <span class="dv">8</span> ] [ <span class="dv">2345</span> <span class="dv">789</span>] [    <span class="dv">5</span> <span class="dv">789</span>] <span class="dv">1</span>           [ <span class="dv">2345</span>  <span class="dv">89</span>]</span>
<span id="cb27-18"><a href="#cb27-18"></a><span class="dv">4</span>           [<span class="dv">1</span> <span class="dv">3</span>   <span class="dv">789</span>] [  <span class="dv">3</span> <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [ <span class="dv">23</span> <span class="dv">567</span> <span class="dv">9</span>] [<span class="dv">123</span>  <span class="dv">6</span> <span class="dv">8</span> ] [<span class="dv">123</span> <span class="dv">5</span> <span class="dv">789</span>] [    <span class="dv">56789</span>] [ <span class="dv">23</span> <span class="dv">56789</span>] [ <span class="dv">23</span> <span class="dv">56</span> <span class="dv">89</span>]</span>
<span id="cb27-19"><a href="#cb27-19"></a>[<span class="dv">1</span>   <span class="dv">5</span> <span class="dv">789</span>] <span class="dv">2</span>           [  <span class="dv">3</span> <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [  <span class="dv">3</span> <span class="dv">567</span> <span class="dv">9</span>] [<span class="dv">1</span> <span class="dv">34</span> <span class="dv">6</span> <span class="dv">8</span> ] [<span class="dv">1</span> <span class="dv">345</span> <span class="dv">789</span>] [    <span class="dv">56789</span>] [  <span class="dv">3456789</span>] [  <span class="dv">3456</span> <span class="dv">89</span>]</span>
<span id="cb27-20"><a href="#cb27-20"></a><span class="dv">2</span>           [  <span class="dv">3</span>  <span class="dv">6</span>  <span class="dv">9</span>] [ <span class="dv">23</span>  <span class="dv">6</span>  <span class="dv">9</span>] [ <span class="dv">23</span>  <span class="dv">6</span>   ] <span class="dv">5</span>           [<span class="dv">123</span>    <span class="dv">8</span> ] <span class="dv">4</span>           [ <span class="dv">2</span>   <span class="dv">6</span> <span class="dv">89</span>] <span class="dv">7</span></span>
<span id="cb27-21"><a href="#cb27-21"></a>[ <span class="dv">2</span>  <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [   <span class="dv">4</span> <span class="dv">67</span> <span class="dv">9</span>] <span class="dv">8</span>           [ <span class="dv">2</span>   <span class="dv">67</span>  ] [<span class="dv">12</span> <span class="dv">4</span> <span class="dv">6</span>   ] [<span class="dv">12</span> <span class="dv">4</span>  <span class="dv">7</span>  ] <span class="dv">3</span>           [ <span class="dv">2</span>  <span class="dv">56</span>  <span class="dv">9</span>] [<span class="dv">12</span>  <span class="dv">56</span>  <span class="dv">9</span>]</span>
<span id="cb27-22"><a href="#cb27-22"></a>[ <span class="dv">2</span>  <span class="dv">5</span> <span class="dv">7</span>  ] [  <span class="dv">34</span> <span class="dv">67</span>  ] <span class="dv">1</span>           [ <span class="dv">23</span>  <span class="dv">67</span>  ] <span class="dv">9</span>           [ <span class="dv">234</span>  <span class="dv">78</span> ] [    <span class="dv">56</span> <span class="dv">8</span> ] [ <span class="dv">2</span>  <span class="dv">56</span> <span class="dv">8</span> ] [ <span class="dv">2</span>  <span class="dv">56</span> <span class="dv">8</span> ]</span>
<span id="cb27-23"><a href="#cb27-23"></a><span class="dv">3</span>           [<span class="dv">1</span>    <span class="dv">6</span> <span class="dv">89</span>] [     <span class="dv">6</span>  <span class="dv">9</span>] <span class="dv">4</span>           <span class="dv">7</span>           [    <span class="dv">5</span>   <span class="dv">9</span>] <span class="dv">2</span>           [    <span class="dv">56</span> <span class="dv">89</span>] [<span class="dv">1</span>   <span class="dv">56</span> <span class="dv">89</span>]</span>
<span id="cb27-24"><a href="#cb27-24"></a>[ <span class="dv">2</span>    <span class="dv">789</span>] <span class="dv">5</span>           [ <span class="dv">2</span> <span class="dv">4</span> <span class="dv">67</span> <span class="dv">9</span>] <span class="dv">1</span>           [ <span class="dv">23</span>      ] [ <span class="dv">23</span>     <span class="dv">9</span>] [     <span class="dv">6789</span>] [  <span class="dv">34</span> <span class="dv">6789</span>] [  <span class="dv">34</span> <span class="dv">6</span> <span class="dv">89</span>]</span>
<span id="cb27-25"><a href="#cb27-25"></a>[<span class="dv">12</span>    <span class="dv">7</span> <span class="dv">9</span>] [<span class="dv">1</span>  <span class="dv">4</span>  <span class="dv">7</span> <span class="dv">9</span>] [ <span class="dv">2</span> <span class="dv">4</span>  <span class="dv">7</span> <span class="dv">9</span>] <span class="dv">8</span>           [ <span class="dv">23</span>      ] <span class="dv">6</span>           [<span class="dv">1</span>   <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [  <span class="dv">345</span> <span class="dv">7</span> <span class="dv">9</span>] [<span class="dv">1</span> <span class="dv">345</span>   <span class="dv">9</span>]</span>
<span id="cb27-26"><a href="#cb27-26"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="fu">putStr</span> <span class="op">$</span> showGridWithPossibilities grid2</span>
<span id="cb27-27"><a href="#cb27-27"></a><span class="dv">6</span>           [  <span class="dv">3</span>   <span class="dv">789</span>] [  <span class="dv">3</span> <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [ <span class="dv">23</span> <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [ <span class="dv">234</span>   <span class="dv">8</span> ] [ <span class="dv">2345</span> <span class="dv">789</span>] [    <span class="dv">5</span> <span class="dv">789</span>] <span class="dv">1</span>           [ <span class="dv">2345</span>  <span class="dv">89</span>]</span>
<span id="cb27-28"><a href="#cb27-28"></a><span class="dv">4</span>           [<span class="dv">1</span> <span class="dv">3</span>   <span class="dv">789</span>] [  <span class="dv">3</span> <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [ <span class="dv">23</span> <span class="dv">567</span> <span class="dv">9</span>] [<span class="dv">123</span>  <span class="dv">6</span> <span class="dv">8</span> ] [<span class="dv">123</span> <span class="dv">5</span> <span class="dv">789</span>] [    <span class="dv">56789</span>] [ <span class="dv">23</span> <span class="dv">56789</span>] [ <span class="dv">23</span> <span class="dv">56</span> <span class="dv">89</span>]</span>
<span id="cb27-29"><a href="#cb27-29"></a>[<span class="dv">1</span>   <span class="dv">5</span> <span class="dv">789</span>] <span class="dv">2</span>           [  <span class="dv">3</span> <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [  <span class="dv">3</span> <span class="dv">567</span> <span class="dv">9</span>] [<span class="dv">1</span> <span class="dv">34</span> <span class="dv">6</span> <span class="dv">8</span> ] [<span class="dv">1</span> <span class="dv">345</span> <span class="dv">789</span>] [    <span class="dv">56789</span>] [  <span class="dv">3456789</span>] [  <span class="dv">3456</span> <span class="dv">89</span>]</span>
<span id="cb27-30"><a href="#cb27-30"></a><span class="dv">9</span>           [  <span class="dv">3</span>  <span class="dv">6</span>  <span class="dv">9</span>] [ <span class="dv">23</span>  <span class="dv">6</span>  <span class="dv">9</span>] [ <span class="dv">23</span>  <span class="dv">6</span>   ] <span class="dv">5</span>           [<span class="dv">123</span>    <span class="dv">8</span> ] <span class="dv">4</span>           [ <span class="dv">2</span>   <span class="dv">6</span> <span class="dv">89</span>] <span class="dv">7</span></span>
<span id="cb27-31"><a href="#cb27-31"></a>[ <span class="dv">2</span>  <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [   <span class="dv">4</span> <span class="dv">67</span> <span class="dv">9</span>] <span class="dv">8</span>           [ <span class="dv">2</span>   <span class="dv">67</span>  ] [<span class="dv">12</span> <span class="dv">4</span> <span class="dv">6</span>   ] [<span class="dv">12</span> <span class="dv">4</span>  <span class="dv">7</span>  ] <span class="dv">3</span>           [ <span class="dv">2</span>  <span class="dv">56</span>  <span class="dv">9</span>] [<span class="dv">12</span>  <span class="dv">56</span>  <span class="dv">9</span>]</span>
<span id="cb27-32"><a href="#cb27-32"></a>[ <span class="dv">2</span>  <span class="dv">5</span> <span class="dv">7</span>  ] [  <span class="dv">34</span> <span class="dv">67</span>  ] <span class="dv">1</span>           [ <span class="dv">23</span>  <span class="dv">67</span>  ] <span class="dv">9</span>           [ <span class="dv">234</span>  <span class="dv">78</span> ] [    <span class="dv">56</span> <span class="dv">8</span> ] [ <span class="dv">2</span>  <span class="dv">56</span> <span class="dv">8</span> ] [ <span class="dv">2</span>  <span class="dv">56</span> <span class="dv">8</span> ]</span>
<span id="cb27-33"><a href="#cb27-33"></a><span class="dv">3</span>           [<span class="dv">1</span>    <span class="dv">6</span> <span class="dv">89</span>] [     <span class="dv">6</span>  <span class="dv">9</span>] <span class="dv">4</span>           <span class="dv">7</span>           [    <span class="dv">5</span>   <span class="dv">9</span>] <span class="dv">2</span>           [    <span class="dv">56</span> <span class="dv">89</span>] [<span class="dv">1</span>   <span class="dv">56</span> <span class="dv">89</span>]</span>
<span id="cb27-34"><a href="#cb27-34"></a>[ <span class="dv">2</span>    <span class="dv">789</span>] <span class="dv">5</span>           [ <span class="dv">2</span> <span class="dv">4</span> <span class="dv">67</span> <span class="dv">9</span>] <span class="dv">1</span>           [ <span class="dv">23</span>      ] [ <span class="dv">23</span>     <span class="dv">9</span>] [     <span class="dv">6789</span>] [  <span class="dv">34</span> <span class="dv">6789</span>] [  <span class="dv">34</span> <span class="dv">6</span> <span class="dv">89</span>]</span>
<span id="cb27-35"><a href="#cb27-35"></a>[<span class="dv">12</span>    <span class="dv">7</span> <span class="dv">9</span>] [<span class="dv">1</span>  <span class="dv">4</span>  <span class="dv">7</span> <span class="dv">9</span>] [ <span class="dv">2</span> <span class="dv">4</span>  <span class="dv">7</span> <span class="dv">9</span>] <span class="dv">8</span>           [ <span class="dv">23</span>      ] <span class="dv">6</span>           [<span class="dv">1</span>   <span class="dv">5</span> <span class="dv">7</span> <span class="dv">9</span>] [  <span class="dv">345</span> <span class="dv">7</span> <span class="dv">9</span>] [<span class="dv">1</span> <span class="dv">345</span>   <span class="dv">9</span>]</span></code></pre></div>
<h2 id="solving-the-puzzle" data-track-content data-content-name="solving-the-puzzle" data-content-piece="fast-sudoku-solver-in-haskell-1">Solving the Puzzle<a href="#solving-the-puzzle" class="ref-link"></a><a href="#top" class="top-link" title="Back to top"></a></h2>
<p>We have implemented parts of our algorithm till now. Now we’ll put everything together to solve the puzzle. First, we need to know if we are done or have messed up:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb28-1"><a href="#cb28-1"></a><span class="ot">isGridFilled ::</span> <span class="dt">Grid</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>isGridFilled grid <span class="ot">=</span> <span class="fu">null</span> [ () <span class="op">|</span> <span class="dt">Possible</span> _ <span class="ot">&lt;-</span> <span class="fu">concat</span> grid ]</span>
<span id="cb28-3"><a href="#cb28-3"></a></span>
<span id="cb28-4"><a href="#cb28-4"></a><span class="ot">isGridInvalid ::</span> <span class="dt">Grid</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span></span>
<span id="cb28-5"><a href="#cb28-5"></a>isGridInvalid grid <span class="ot">=</span></span>
<span id="cb28-6"><a href="#cb28-6"></a>  <span class="fu">any</span> isInvalidRow grid</span>
<span id="cb28-7"><a href="#cb28-7"></a>  <span class="op">||</span> <span class="fu">any</span> isInvalidRow (Data.List.transpose grid)</span>
<span id="cb28-8"><a href="#cb28-8"></a>  <span class="op">||</span> <span class="fu">any</span> isInvalidRow (subGridsToRows grid)</span>
<span id="cb28-9"><a href="#cb28-9"></a>  <span class="kw">where</span></span>
<span id="cb28-10"><a href="#cb28-10"></a>    isInvalidRow row <span class="ot">=</span></span>
<span id="cb28-11"><a href="#cb28-11"></a>      <span class="kw">let</span> fixeds         <span class="ot">=</span> [x <span class="op">|</span> <span class="dt">Fixed</span> x <span class="ot">&lt;-</span> row]</span>
<span id="cb28-12"><a href="#cb28-12"></a>          emptyPossibles <span class="ot">=</span> [x <span class="op">|</span> <span class="dt">Possible</span> x <span class="ot">&lt;-</span> row, <span class="fu">null</span> x]</span>
<span id="cb28-13"><a href="#cb28-13"></a>      <span class="kw">in</span> hasDups fixeds <span class="op">||</span> <span class="fu">not</span> (<span class="fu">null</span> emptyPossibles)</span>
<span id="cb28-14"><a href="#cb28-14"></a></span>
<span id="cb28-15"><a href="#cb28-15"></a>    hasDups l <span class="ot">=</span> hasDups' l []</span>
<span id="cb28-16"><a href="#cb28-16"></a></span>
<span id="cb28-17"><a href="#cb28-17"></a>    hasDups' [] _ <span class="ot">=</span> <span class="dt">False</span></span>
<span id="cb28-18"><a href="#cb28-18"></a>    hasDups' (y<span class="op">:</span>ys) xs</span>
<span id="cb28-19"><a href="#cb28-19"></a>      <span class="op">|</span> y <span class="ot">`elem`</span> xs <span class="ot">=</span> <span class="dt">True</span></span>
<span id="cb28-20"><a href="#cb28-20"></a>      <span class="op">|</span> <span class="fu">otherwise</span>   <span class="ot">=</span> hasDups' ys (y<span class="op">:</span>xs)</span></code></pre></div>
<p><code>isGridFilled</code> returns whether a grid is filled completely by checking it for any <code>Possible</code> cells. <code>isGridInvalid</code> checks if a grid is invalid because it either has duplicate fixed cells in any block or has any non-fixed cell with no possibilities.</p>
<p>Writing the <code>solve</code> function is almost trivial now:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb29-1"><a href="#cb29-1"></a><span class="ot">solve ::</span> <span class="dt">Grid</span> <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">Grid</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>solve grid <span class="ot">=</span> pruneGrid grid <span class="op">&gt;&gt;=</span> solve'</span>
<span id="cb29-3"><a href="#cb29-3"></a>  <span class="kw">where</span></span>
<span id="cb29-4"><a href="#cb29-4"></a>    solve' g</span>
<span id="cb29-5"><a href="#cb29-5"></a>      <span class="op">|</span> isGridInvalid g <span class="ot">=</span> <span class="dt">Nothing</span></span>
<span id="cb29-6"><a href="#cb29-6"></a>      <span class="op">|</span> isGridFilled g  <span class="ot">=</span> <span class="dt">Just</span> g</span>
<span id="cb29-7"><a href="#cb29-7"></a>      <span class="op">|</span> <span class="fu">otherwise</span>       <span class="ot">=</span></span>
<span id="cb29-8"><a href="#cb29-8"></a>          <span class="kw">let</span> (grid1, grid2) <span class="ot">=</span> nextGrids g</span>
<span id="cb29-9"><a href="#cb29-9"></a>          <span class="kw">in</span> solve grid1 <span class="op">&lt;|&gt;</span> solve grid2</span></code></pre></div>
<p>We prune the grid as before and pipe it to the helper function <code>solve'</code>. <code>solve'</code> bails with a <code>Nothing</code> if the grid is invalid, or returns the solved grid if it is filled completely. Otherwise, it finds the next two grids in the search tree and solves them recursively with backtracking by calling the <code>solve</code> function. Backtracking here is implemented by the using the <a href="https://hackage.haskell.org/package/base-4.11.1.0/docs/Control-Applicative.html#g:2" target="_blank" rel="noopener"><code>Alternative</code></a> (<code>&lt;|&gt;</code>) implementation of the <code>Maybe</code> type<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. It takes the second branch in the computation if the first branch returns a <code>Nothing</code>.</p>
<p>Whew! That took us long. Let’s put it to the final test now:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb31-1"><a href="#cb31-1"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="dt">Just</span> grid <span class="ot">=</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>  readGrid <span class="st">&quot;6......1.4.........2...........5.4.7..8...3....1.9....3..4..2...5.1........8.6...&quot;</span></span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="fu">putStr</span> <span class="op">$</span> showGrid grid</span>
<span id="cb31-4"><a href="#cb31-4"></a><span class="dv">6</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="dv">1</span> <span class="op">.</span></span>
<span id="cb31-5"><a href="#cb31-5"></a><span class="dv">4</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span></span>
<span id="cb31-6"><a href="#cb31-6"></a><span class="op">.</span> <span class="dv">2</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span></span>
<span id="cb31-7"><a href="#cb31-7"></a><span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="dv">5</span> <span class="op">.</span> <span class="dv">4</span> <span class="op">.</span> <span class="dv">7</span></span>
<span id="cb31-8"><a href="#cb31-8"></a><span class="op">.</span> <span class="op">.</span> <span class="dv">8</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="dv">3</span> <span class="op">.</span> <span class="op">.</span></span>
<span id="cb31-9"><a href="#cb31-9"></a><span class="op">.</span> <span class="op">.</span> <span class="dv">1</span> <span class="op">.</span> <span class="dv">9</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span></span>
<span id="cb31-10"><a href="#cb31-10"></a><span class="dv">3</span> <span class="op">.</span> <span class="op">.</span> <span class="dv">4</span> <span class="op">.</span> <span class="op">.</span> <span class="dv">2</span> <span class="op">.</span> <span class="op">.</span></span>
<span id="cb31-11"><a href="#cb31-11"></a><span class="op">.</span> <span class="dv">5</span> <span class="op">.</span> <span class="dv">1</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span></span>
<span id="cb31-12"><a href="#cb31-12"></a><span class="op">.</span> <span class="op">.</span> <span class="op">.</span> <span class="dv">8</span> <span class="op">.</span> <span class="dv">6</span> <span class="op">.</span> <span class="op">.</span> <span class="op">.</span></span>
<span id="cb31-13"><a href="#cb31-13"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="dt">Just</span> grid' <span class="ot">=</span> solve grid</span>
<span id="cb31-14"><a href="#cb31-14"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="fu">putStr</span> <span class="op">$</span> showGrid grid'</span>
<span id="cb31-15"><a href="#cb31-15"></a><span class="dv">6</span> <span class="dv">9</span> <span class="dv">3</span> <span class="dv">7</span> <span class="dv">8</span> <span class="dv">4</span> <span class="dv">5</span> <span class="dv">1</span> <span class="dv">2</span></span>
<span id="cb31-16"><a href="#cb31-16"></a><span class="dv">4</span> <span class="dv">8</span> <span class="dv">7</span> <span class="dv">5</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">9</span> <span class="dv">3</span> <span class="dv">6</span></span>
<span id="cb31-17"><a href="#cb31-17"></a><span class="dv">1</span> <span class="dv">2</span> <span class="dv">5</span> <span class="dv">9</span> <span class="dv">6</span> <span class="dv">3</span> <span class="dv">8</span> <span class="dv">7</span> <span class="dv">4</span></span>
<span id="cb31-18"><a href="#cb31-18"></a><span class="dv">9</span> <span class="dv">3</span> <span class="dv">2</span> <span class="dv">6</span> <span class="dv">5</span> <span class="dv">1</span> <span class="dv">4</span> <span class="dv">8</span> <span class="dv">7</span></span>
<span id="cb31-19"><a href="#cb31-19"></a><span class="dv">5</span> <span class="dv">6</span> <span class="dv">8</span> <span class="dv">2</span> <span class="dv">4</span> <span class="dv">7</span> <span class="dv">3</span> <span class="dv">9</span> <span class="dv">1</span></span>
<span id="cb31-20"><a href="#cb31-20"></a><span class="dv">7</span> <span class="dv">4</span> <span class="dv">1</span> <span class="dv">3</span> <span class="dv">9</span> <span class="dv">8</span> <span class="dv">6</span> <span class="dv">2</span> <span class="dv">5</span></span>
<span id="cb31-21"><a href="#cb31-21"></a><span class="dv">3</span> <span class="dv">1</span> <span class="dv">9</span> <span class="dv">4</span> <span class="dv">7</span> <span class="dv">5</span> <span class="dv">2</span> <span class="dv">6</span> <span class="dv">8</span></span>
<span id="cb31-22"><a href="#cb31-22"></a><span class="dv">8</span> <span class="dv">5</span> <span class="dv">6</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">9</span> <span class="dv">7</span> <span class="dv">4</span> <span class="dv">3</span></span>
<span id="cb31-23"><a href="#cb31-23"></a><span class="dv">2</span> <span class="dv">7</span> <span class="dv">4</span> <span class="dv">8</span> <span class="dv">3</span> <span class="dv">6</span> <span class="dv">1</span> <span class="dv">5</span> <span class="dv">9</span></span></code></pre></div>
<p>It works! Let’s put a quick <code>main</code> wrapper around <code>solve</code> to call it from the command line:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb32-1"><a href="#cb32-1"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb32-2"><a href="#cb32-2"></a>main <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb32-3"><a href="#cb32-3"></a>  inputs <span class="ot">&lt;-</span> <span class="fu">lines</span> <span class="op">&lt;$&gt;</span> <span class="fu">getContents</span></span>
<span id="cb32-4"><a href="#cb32-4"></a>  Control.Monad.forM_ inputs <span class="op">$</span> \input <span class="ot">-&gt;</span></span>
<span id="cb32-5"><a href="#cb32-5"></a>    <span class="kw">case</span> readGrid input <span class="kw">of</span></span>
<span id="cb32-6"><a href="#cb32-6"></a>      <span class="dt">Nothing</span>   <span class="ot">-&gt;</span> <span class="fu">putStrLn</span> <span class="st">&quot;Invalid input&quot;</span></span>
<span id="cb32-7"><a href="#cb32-7"></a>      <span class="dt">Just</span> grid <span class="ot">-&gt;</span> <span class="kw">case</span> solve grid <span class="kw">of</span></span>
<span id="cb32-8"><a href="#cb32-8"></a>        <span class="dt">Nothing</span>    <span class="ot">-&gt;</span> <span class="fu">putStrLn</span> <span class="st">&quot;No solution found&quot;</span></span>
<span id="cb32-9"><a href="#cb32-9"></a>        <span class="dt">Just</span> grid' <span class="ot">-&gt;</span> <span class="fu">putStrLn</span> <span class="op">$</span> showGrid grid'</span></code></pre></div>
<p>And now, we can invoke it from the command line:</p>
<pre class="plain"><code>$ echo &quot;.......12.5.4............3.7..6..4....1..........8....92....8.....51.7.......3...&quot; | stack exec sudoku
3 6 4 9 7 8 5 1 2
1 5 2 4 3 6 9 7 8
8 7 9 1 2 5 6 3 4
7 3 8 6 5 1 4 2 9
6 9 1 2 4 7 3 8 5
2 4 5 3 8 9 1 6 7
9 2 3 7 6 4 8 5 1
4 8 6 5 1 2 7 9 3
5 1 7 8 9 3 2 4 6</code></pre>
<p>And, we are done.</p>
<p>If you want to play with different puzzles, the file <a href="//abhinavsarkar.net/files/sudoku17.txt.bz2">here</a> lists some of the toughest ones. Let’s run<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> some of them through our program to see how fast it is:</p>
<pre class="plain"><code>$ head -n100 sudoku17.txt | time stack exec sudoku
... output omitted ...
      116.70 real       198.09 user        94.46 sys</code></pre>
<p>It took about 117 seconds to solve a hundred puzzles, so, about 1.2 seconds per puzzle. This is pretty slow but we’ll get around to making it faster in the subsequent posts.</p>
<h2 id="conclusion" data-track-content data-content-name="conclusion" data-content-piece="fast-sudoku-solver-in-haskell-1">Conclusion<a href="#conclusion" class="ref-link"></a><a href="#top" class="top-link" title="Back to top"></a></h2>
<p>In this rather verbose article, we learned how to write a simple Sudoku solver in Haskell step-by-step. In the later parts of this series, we’ll delve into profiling the solution and figuring out better algorithms and data structures to solve Sudoku more efficiently. The code till now is available <a href="https://code.abhinavsarkar.net/abhin4v/hasdoku/src/commit/0ef77341a10fcc25926301ee47b931d92959c0fa" target="_blank" rel="noopener">here</a>. Discuss this post on <a href="https://www.reddit.com/r/haskell/comments/8uapij/fast_sudoku_solver_in_haskell/" target="_blank" rel="noopener">r/haskell</a> or <a href="//abhinavsarkar.net/posts/fast-sudoku-solver-in-haskell-1/#comment-container">leave a comment</a>.</p>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>This exercise was originally done as a part of <a href="https://github.com/pratul/haskell-classes/" target="_blank" rel="noopener">the</a> <a href="https://github.com/ford-prefect/haskell-classes/" target="_blank" rel="noopener">Haskell</a> <a href="https://github.com/bnvinay92/haskell-classes/" target="_blank" rel="noopener">classes</a> I taught at <a href="https://nilenso.com" target="_blank" rel="noopener">nilenso</a>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p><code>Alternative</code> implementation of <code>Maybe</code>:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb30-1"><a href="#cb30-1"></a><span class="kw">instance</span> <span class="dt">Alternative</span> <span class="dt">Maybe</span> <span class="kw">where</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>  empty <span class="ot">=</span> <span class="dt">Nothing</span></span>
<span id="cb30-3"><a href="#cb30-3"></a>  <span class="dt">Nothing</span> <span class="op">&lt;|&gt;</span> r <span class="ot">=</span> r</span>
<span id="cb30-4"><a href="#cb30-4"></a>  l       <span class="op">&lt;|&gt;</span> _ <span class="ot">=</span> l</span></code></pre></div>
<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></li>
<li id="fn3" role="doc-endnote"><p>All the runs were done on my MacBook Pro from 2014 with 2.2 GHz Intel Core i7 CPU and 16 GB memory.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
    </section>
    <section class="source">
        
          Posted by <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span itemprop="name" class="p-author">Abhinav Sarkar</span>
          </span>
        
      <a href="https://github.com/abhin4v/abhin4v.github.io/commits/source/posts/fast-sudoku-solver-in-haskell-1.md" target="_blank" rel="noopener" style="float: right;">
        Post history
      </a>
    </section>
</article>
<span itemprop="url" content="https://abhinavsarkar.net/posts/fast-sudoku-solver-in-haskell-1/" style="display: none" class="u-url u-uid">https://abhinavsarkar.net/posts/fast-sudoku-solver-in-haskell-1/</span>

<div class="subscription-msg">
  <h3>Like this post? Subscribe below to get future posts by email.</h3>
<form id="subscription" action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open('https://feedburner.google.com/fb/a/mailverify?uri=abhinavsarkarnet', 'popupwindow', 'scrollbars=yes,width=550,height=520');return true">
  <input type="email" name="email" required placeholder="your.email@example.com" />
  <input type="hidden" value="abhinavsarkarnet" name="uri" />
  <input type="hidden" name="loc" value="en_US" />
  <input type="submit" value="Subscribe" />
</form>

</div>


<div id="comment-container">
  <form method="POST" action="https://dev.staticman.net/v3/entry/github/abhin4v/abhin4v.github.io/source/comments" id="comment-form">
    <a id="cancel-reply">Cancel Reply</a>
    <h3>Got suggestions, corrections, or thoughts? Post a comment!</h3>
    <fieldset>
      <input name="options[slug]" type="hidden" value="fast-sudoku-solver-in-haskell-1">
      <input id="comment-redirect" name="options[redirect]" type="hidden" value="https://abhinavsarkar.net/posts/fast-sudoku-solver-in-haskell-1/">
      <!--
      <input type="hidden" name="options[reCaptcha][siteKey]" value="6LfX6DMUAAAAAK_kbS1LfKKy4bNJbsUmyZFADnfV">
      <input type="hidden" name="options[reCaptcha][secret]" value="xE425Zd96uokSf/t1saMqEvj17HfjYJ4+/gv6B4uqA+PxiCjwSb8BUYeWrIBRKrz+YRLCkC53qSa9HYfBNWohuI1+9SBpw5XJ9WJkilJ/DaSjWP9FsKQM9OLdMDgGo8fUQ3hlfs4svgBzItjOitabrjvYI4u0k4RTsq5ccYISeo=">
       -->
      <input type="hidden" id="comment-parent" name="fields[reply_to]" value>
      <input type="text" id="comment-website" name="fields[website]" value placeholder="Do not fill this field" aria-hidden="true">
      <textarea id="comment-text" name="fields[message]" required placeholder="Comment"></textarea>
      <span style="font-size: smaller">
        <a href="https://kramdown.gettalong.org/quickref.html" target="_blank" rel="noopener">Markdown</a> is allowed
      </span>
      <input name="fields[name]" type="text" required placeholder="Name">
      <input name="fields[email]" type="email" required placeholder="Email">
      <div style="font-size: smaller; margin-bottom: 1em;">
          Email is used just to show an avatar image and is not displayed or stored
      </div>
      <!-- <div class="g-recaptcha" data-sitekey="6LfX6DMUAAAAAK_kbS1LfKKy4bNJbsUmyZFADnfV"></div> -->
      <input id="comment-form-submit" type="submit" value="Post Comment">
      <div style="font-size: smaller;">Comments are moderated. They will appear below after they are approved.</div>
      <div id="comment-form-message"></div>
    </fieldset>
  </form>
  <div class="comments">
    <h3>2 comments
      <a href="#top" class="top-link" title="Back to top"></a>
    </h3>
    
      <article class="comment level-0">
  <div id="comment-c9b9da50-0151-11e9-bdf0-35d18cce6106">
    <input type="submit" value="Reply" name="Liam###c9b9da50-0151-11e9-bdf0-35d18cce6106">
    <img class="avatar" src="https://www.gravatar.com/avatar/79e76c1adb3db7cdad75e82784ac3c0e?d=retro&s=60">
    <span>
      <h4 class="author ">Liam</h4>
      <div class="date" title="2018-12-16T16:44:00.565Z">December 16, 2018</div>
    </span>
  </div>
  <div class="message"><p>I’m really enjoying this and trying to follow along but I’m wondering is the <code>case xs Data.List.\\ fixeds of case...</code> part has a mistake? I can’t seem to figure how to make this bit work but the same thing is present in your source code all through the history so it seems like it must have worked at some point. Any help or clarification would be much appreciated!</p></div>
</article>

    
      <article class="comment level-1">
  <div id="comment-ecd14f50-01a6-11e9-bdf0-35d18cce6106">
    <input type="submit" value="Reply" name="Abhinav Sarkar###ecd14f50-01a6-11e9-bdf0-35d18cce6106">
    <img class="avatar" src="https://www.gravatar.com/avatar/4d29918c109bc75d2a1fd8420660d72b?d=retro&s=60">
    <span>
      <h4 class="author post-author" title="Author">Abhinav Sarkar</h4>
      <div class="date" title="2018-12-17T02:53:26.795Z">December 17, 2018</div>
    </span>
  </div>
  <div class="message"><p>Hey Liam. <code>Data.List.\\</code> is a legitimate function. You can see it in the docs <a href="http://hackage.haskell.org/package/base/docs/Data-List.html#v:-92--92-" target="_blank" rel="noopener">here</a>. Make sure that you are importing the module correctly like this: <code>import qualified Data.List</code>. It should work. If not, can you please tell what error you are getting?</p></div>
</article>

    
  </div>
</div>
<script src="//abhinavsarkar.net/js/comment-form.js" defer async></script>
<!-- <script src="https://www.google.com/recaptcha/api.js" defer async></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.3/fetch.min.js" defer async></script>
<script src="https://cdn.jsdelivr.net/npm/promise-polyfill@6.1.0/promise.min.js" defer async></script>



<div id="mentions-container">
  <h3>32 mentions
    <a href="#top" class="top-link" title="Back to top"></a>
  </h3>
  <ul>
  
    <li class="mention" id="#mention-540994">
      <a href="https://haskellweekly.news/issues/114.html" target="_blank" rel="noopener">haskellweekly.news</a>
      <span class="date">Aug 11, 2018</span>
    </li>
  
    <li class="mention" id="#mention-540995">
      <a href="https://www.reddit.com/r/haskell/comments/8uapij/fast_sudoku_solver_in_haskell/" target="_blank" rel="noopener">reddit/r/haskell</a>
      <span class="date">Aug 11, 2018</span>
    </li>
  
    <li class="mention" id="#mention-540997">
      <a href="https://lobste.rs/s/trafke/fast_sudoku_solver_haskell_1_simple" target="_blank" rel="noopener">lobste.rs</a>
      <span class="date">Aug 11, 2018</span>
    </li>
  
    <li class="mention" id="#mention-541001">
      <a href="https://mailchi.mp/humanreadablemag/box-pruning-javascript-proxies-solving-sudoku-with-constraint-satisfaction-oh-mymorning-cup-of-coding-issue-73" target="_blank" rel="noopener">humanreadablemag</a>
      <span class="date">Aug 11, 2018</span>
    </li>
  
    <li class="mention" id="#mention-541039">
      <a href="https://github.com/Armavica/mrsudoku" target="_blank" rel="noopener">github/Armavica/mrsudoku</a>
      <span class="date">Aug 11, 2018</span>
    </li>
  
    <li class="mention" id="#mention-541040">
      <a href="https://github.com/nshimaza/sudoku-solver" target="_blank" rel="noopener">github/nshimaza/sudoku-solver</a>
      <span class="date">Aug 11, 2018</span>
    </li>
  
    <li class="mention" id="#mention-542209">
      <a href="https://lambdahackers.com/@tiensonqin/fast-sudoku-solver-in-haskell-1-a-simple-solution-4uw2dm7yv2" target="_blank" rel="noopener">lambdahackers.com</a>
      <span class="date">Aug 17, 2018</span>
    </li>
  
    <li class="mention" id="#mention-549112">
      <a href="https://www.reddit.com/r/Idris/comments/994x7a/how_do_i_model_a_finite_set_in_a_type_safe_way/" target="_blank" rel="noopener">reddit/r/Idris</a>
      <span class="date">Sep 17, 2018</span>
    </li>
  
    <li class="mention" id="#mention-572195">
      <a href="https://github.com/Boshen/sudoku" target="_blank" rel="noopener">github/Boshen/sudoku</a>
      <span class="date">Dec 28, 2018</span>
    </li>
  
    <li class="mention" id="#mention-582087">
      <a href="https://github.com/BartMassey/sudoku-solver-hs" target="_blank" rel="noopener">github/BartMassey/sudoku-solver-hs</a>
      <span class="date">Jan 26, 2019</span>
    </li>
  
    <li class="mention" id="#mention-540996">
      <a href="https://www.reddit.com/r/programming/comments/8uh7cm/fast_sudoku_solver_in_haskell/" target="_blank" rel="noopener">reddit/r/programming</a>
      <span class="date">Aug 11, 2018</span>
    </li>
  

  
  <div class="likes">
    21 Likes:
    <a href="https://twitter.com/AhamPiyush" target="_blank" rel="noopener">Piyush Katariya</a><a href="https://twitter.com/DanielPous" target="_blank" rel="noopener">Dani</a><a href="https://twitter.com/haskmancer" target="_blank" rel="noopener">.hs</a><a href="https://twitter.com/OndrejSlamecka" target="_blank" rel="noopener">Ondřej Slámečka</a><a href="https://twitter.com/_kevinliao" target="_blank" rel="noopener">Kevin Liao</a><a href="https://twitter.com/jneira" target="_blank" rel="noopener">Javier Neira</a><a href="https://twitter.com/dfacastro" target="_blank" rel="noopener">Diogo Castro</a><a href="https://twitter.com/rdivyanshu" target="_blank" rel="noopener">Divyanshu Ranjan</a><a href="https://twitter.com/CoderDennis" target="_blank" rel="noopener">Dennis Palmer</a><a href="https://twitter.com/akarp" target="_blank" rel="noopener">Anatoly Karp</a><a href="https://twitter.com/tylerweir" target="_blank" rel="noopener">Tyler Weir</a><a href="https://twitter.com/dganti1" target="_blank" rel="noopener">Dinkar Ganti</a><a href="https://twitter.com/J9794" target="_blank" rel="noopener">J9</a><a href="https://twitter.com/functorcnidaria" target="_blank" rel="noopener">ruko</a><a href="https://twitter.com/ipengi" target="_blank" rel="noopener">iPengi</a><a href="https://twitter.com/kephasp" target="_blank" rel="noopener">Pierre Thierry</a><a href="https://twitter.com/yastero" target="_blank" rel="noopener">Dave Rostron</a><a href="https://twitter.com/clementd" target="_blank" rel="noopener">cλementd</a><a href="https://twitter.com/amfier" target="_blank" rel="noopener">Artem Kozin</a><a href="https://twitter.com/shbaik82" target="_blank" rel="noopener">peachblack</a><a href="https://twitter.com/dnene" target="_blank" rel="noopener">Dhananjay Nene</a>
  </div>
  

  
  </ul>
</div>
  


<ul class="pager">
  <li class="previous">
    
    <a href="//abhinavsarkar.net/posts/ps-simple-rest-service-2/" title="Previous">
      <svg class="assist-icon" xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8">
        <path d="M4 0l-4 4 4 4 1.5-1.5-2.5-2.5 2.5-2.5-1.5-1.5z" transform="translate(1)"></path>
      </svg>
      <span class="ind">Previous</span> <br>
      <span class="title">Writing a Simple REST Web Service in PureScript - Part 2</span>
    </a>
    
  </li>

  <li class="next">
    
    <a href="//abhinavsarkar.net/posts/fast-sudoku-solver-in-haskell-2/" title="Next">
      <span class="ind">Next</span>
      <svg class="assist-icon" xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8">
        <path d="M1.5 0l-1.5 1.5 2.5 2.5-2.5 2.5 1.5 1.5 4-4-4-4z" transform="translate(1)"></path>
      </svg> <br>
      <span class="title">Fast Sudoku Solver in Haskell #2: A 200x Faster Solution</span>
    </a>
    
  </li>
</ul>

<script src="//abhinavsarkar.net/js/post-styling.js" defer async></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/haskell.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.1.0/highlightjs-line-numbers.min.js"></script>
<script src="https://platform.twitter.com/widgets.js" charset="utf-8" defer async></script>
<script>
  hljs.initHighlightingOnLoad();
  hljs.initLineNumbersOnLoad({
    singleLine: true
  });

  window.setTimeout(function() {
      if (window.twttr == undefined) {
        document.getElementsByClassName("twitter-button")[0].setAttribute("style", "display: none");
      }
    }, 3000);
</script>


        </main>

        <footer>
          <nav id="bottomnav">
            <span class="links">
                <a href="//abhinavsarkar.net/">Home</a>
                <a href="//abhinavsarkar.net/about/">About</a>
<a href="//abhinavsarkar.net/archive/">Posts</a>
<a href="//abhinavsarkar.net/notes/">Notes</a>
<a href="//abhinavsarkar.net/photos/">Photos</a>
<a href="//abhinavsarkar.net/readings/">Readings</a>
<a href="//abhinavsarkar.net/now/">Now</a>
            </span>
          </nav>
          <div id="copy">
            <span style="float: left">© 2017–2020, Abhinav Sarkar</span>
            Generated by <a href="http://jaspervdj.be/hakyll" target="_blank" rel="noopener">Hakyll</a>
            <span id="gen-time" class="hide-small"></span> |
            <a href="https://github.com/abhin4v/abhin4v.github.io" target="_blank" rel="noopener">Source</a>
          </div>
        </footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>
      document.documentElement.className = document.documentElement.className.replace("no-js","js");

      jQuery("nav .links a").each(function() {
        if (new URL(this.href).pathname === window.location.pathname) {
          jQuery(this).css('font-weight', 'bold');
        }
      });

      function loadStyleSheet(src, media) {
        var ssHtml = "<link rel='stylesheet' href='"+src+"' type='text/css'";
        if (media !== undefined) {
          ssHtml += " media='" + media + "''";
        }
        ssHtml += ">"
        jQuery("head").append(jQuery(ssHtml));
      }

      jQuery(window).ready(function setGenTime() {
        if (window.performance && window.performance.timing) {
          var t = window.performance.timing;
          var elapsed = t.loadEventEnd - t.navigationStart;
          if (elapsed >= 0) {
            jQuery("#gen-time").text("| Served in " + elapsed + " ms");
          } else {
            window.setTimeout(setGenTime, 1000);
          }
        }
      });
    </script>
    <style type="text/css" media="print">
      @page {
        size: A4;
        margin: 12mm 17mm 12mm 17mm;
      }
    </style>
  </body>
</html>
