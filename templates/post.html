<article itemscope itemtype="http://schema.org/Article" class="post">
    <header>
        <h1 itemprop="name" id="#top">$title$</h1>
    </header>
    <section class="header">
        <span class="fa fa-pencil fa-fw" aria-hidden="true"></span>
        Posted on <span itemprop="datePublished" content="$date_num$">$date$</span>
        $if(author)$
            by <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">$author$</span></span>
        $endif$
    </section>
    <section class="header">
        $if(tags)$
        <span class="fa fa-tags fa-fw" aria-hidden="true"></span> Tags: $tags$
        $endif$
    </section>
    <section itemprop="articleBody" class="body">
        $body$
    </section>
    <a href="/$path$" class="source">Source</a>
</article>
<meta itemprop="url" content="$full_url$">
<div style="border-top: 1px solid #ababab;">
  <h3>$comment_count$ comments</h3>
  <div class="comments">
  $for(comments)$
      $body$
      <hr>
  $endfor$
  </div>
  <form method="POST" action="https://api.staticman.net/v2/entry/abhin4v/abhin4v.github.io/source/comments"
        id="comment-form">
    <h3>Leave a comment</h3>
    <fieldset>
      <input name="options[slug]" type="hidden" value="$post_slug$">
      <textarea name="fields[message]" required placeholder="Comment"></textarea>
      <span style="font-size: small"><a href="https://kramdown.gettalong.org/quickref.html">Markdown</a> is allowed</span>
      <input name="fields[name]" type="text" required placeholder="Name">
      <input name="fields[email]" type="email" required placeholder="Email">
      <input id="comment-form-submit" type="submit" value="Post Comment">
    </fieldset>
  </form>
</div>

<script>
(function() {
  function addCommentSubmitHandler() {
    if (typeof jQuery !== 'undefined') {
      jQuery("#comment-form").on("submit", function(event) {
        event.preventDefault();
        var form = jQuery(this);
        var reqBody = form.serialize();
        jQuery("#comment-form fieldset").attr("disabled", "disabled");
        var formMessage = jQuery("#comment-form-submit");
        var origVal = formMessage.val();
        var origWidth = formMessage.css("width");
        formMessage.val("Submitting ...");

        fetch(form.attr("action"), {
          method: form.attr("method"),
          body: reqBody,
          headers: {
            "Content-Type": "application/x-www-form-urlencoded"
          }})
        .then(function(response) {
          formMessage.css("width", "80%");
          if (!response.ok) {
            formMessage.val("Sorry, there was an error in submitting the comment.");
          } else {
            formMessage.val("Thanks for your comment. It will show on the site once it has been approved.");
          }
          window.setTimeout(function() {
            formMessage.val(origVal);
            formMessage.css("width", origWidth);
            jQuery("#comment-form fieldset").removeAttr("disabled");
          }, 3000);
        });
      });
    } else {
      window.setTimeout(addCommentSubmitHandler, 1000);
    }
  }

  addCommentSubmitHandler();
}());
</script>
