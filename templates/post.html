<article itemscope itemtype="http://schema.org/Article" class="post">
    <header>
        <h1 itemprop="name" id="#top">$title$</h1>
    </header>
    <section class="header">
        <span class="fa fa-pencil fa-fw" aria-hidden="true"></span>
        Posted on <span itemprop="datePublished" content="$date_num$">$date$</span>
        $if(author)$
            by <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">$author$</span></span>
        $endif$
    </section>
    <section class="header">
        $if(tags)$
        <span class="fa fa-tags fa-fw" aria-hidden="true"></span> Tags: $tags$
        $endif$
    </section>
    <section itemprop="articleBody" class="body">
        $body$
    </section>
    <a href="/$path$" class="source">Source</a>
</article>
<meta itemprop="url" content="$full_url$">
<div id="comment-container">
  <h3>$comment_count$ comments</h3>
  <div class="comments">
  $for(comments)$
      $body$
      <hr>
  $endfor$
  </div>
  <form method="POST" action="https://api.staticman.net/v2/entry/abhin4v/abhin4v.github.io/source/comments"
        id="comment-form">
    <h3>Leave a comment</h3>
    <p>Comments are moderated. They will appear here after they are approved.</p>
    <fieldset>
      <input name="options[slug]" type="hidden" value="$post_slug$">
      <input id="comment-redirect" name="options[redirect]" type="hidden" value="$full_url$">
      <textarea name="fields[message]" required placeholder="Comment"></textarea>
      <span style="font-size: small">
        <a href="https://kramdown.gettalong.org/quickref.html" target="_blank" rel="noopener">Markdown</a> is allowed
      </span>
      <input name="fields[name]" type="text" required placeholder="Name">
      <input name="fields[email]" type="email" required placeholder="Email">
      <input id="comment-form-submit" type="submit" value="Post Comment">
      <span id="comment-form-message"></span>
    </fieldset>
  </form>
</div>

<script>
(function() {
  function addCommentSubmitHandler() {
    if (typeof jQuery !== 'undefined') {
      var jq = jQuery;
      jq("#comment-redirect").remove();
      jq("#comment-form").on("submit", function(event) {
        event.preventDefault();
        var form = jq(this);
        var reqBody = form.serialize();
        jq("#comment-form fieldset").attr("disabled", "disabled");

        var formSubmit = jq("#comment-form-submit");
        var origVal = formSubmit.val();
        formSubmit.val("Posting ...");

        fetch(form.attr("action"), {
          method: form.attr("method"),
          body: reqBody,
          headers: {
            "Content-Type": "application/x-www-form-urlencoded"
          }})
        .then(function(response) {
          var formMessage = jq("#comment-form-message");
          formSubmit.val(origVal);
          jq("#comment-form fieldset").removeAttr("disabled");

          if (!response.ok) {
            formMessage.html("Sorry, there was an error in posting the comment.").fadeIn("slow");
          } else {
            form.trigger("reset");
            formMessage.html("Thanks for your comment. It will show on the site once it has been approved.").fadeIn("slow");
          }
          window.setTimeout(function() { formMessage.fadeOut("slow"); }, 5000);
        });
        return false;
      });
    } else {
      window.setTimeout(addCommentSubmitHandler, 1000);
    }
  }

  addCommentSubmitHandler();
}());
</script>
